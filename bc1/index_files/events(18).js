/*! For license information please see events.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.events=t():e.events=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";var r,o;Object.defineProperty(t,"__esModule",{value:!0}),t.PRODUCTION=t.BROWSER_PREFIXS=t.SDK_VERSION=t.API=t.KWAI_SESSION_ID=t.REPORT_TYPE=t.EVENT_NAME_FORMAT=t.EVENT_NAME=t.PAGE_VIEW_EVENT_NAME=t.UNKNOWN_EVENT=t.PAGE_ID=t.SESSION_ID=t.KWAI_Q=t.KWAI_ANALYTICS_OBJECT=t.KWAI_CALLBACK_SESSION_KEY=t.KWAI_PIXEL_ID=t.KWAI_CALLBACK=t.KWAI_TEST_ID=void 0,t.KWAI_TEST_ID="ks_px_test",t.KWAI_CALLBACK="click_id",t.KWAI_PIXEL_ID="pixel_id",t.KWAI_CALLBACK_SESSION_KEY="kwai_adInfo",t.KWAI_ANALYTICS_OBJECT="KwaiAnalyticsObject",t.KWAI_Q="kwaiq",t.SESSION_ID="sessionId",t.PAGE_ID="pageId",t.UNKNOWN_EVENT="UNKNOWN",t.PAGE_VIEW_EVENT_NAME="pageView",t.EVENT_NAME={pageView:"EVENT_PAGE_VIEW",addPaymentInfo:"EVENT_ADD_PAYMENT_INFO",addToCart:"EVENT_ADD_TO_CART",buttonClick:"EVENT_BUTTON_CLICK",purchase:"EVENT_PURCHASE",contentView:"EVENT_CONTENT_VIEW",download:"EVENT_DOWNLOAD",formSubmit:"EVENT_FORM_SUBMIT",initiatedCheckout:"EVENT_INITIATED_CHECKOUT",contact:"EVENT_CONTACT",placeOrder:"EVENT_PLACE_ORDER",search:"EVENT_SERACH",completeRegistration:"EVENT_COMPLETE_REGISTRATION",addToWishlist:"EVENT_ADD_TO_WISHLIST",subscribe:"EVENT_SUBSCRIBE",firstDeposit:"EVENT_FIRST_DEPOSIT",creditApproval:"EVENT_CREDIT_APPROVAL",loanApplication:"EVENT_LOAN_APPLICATION",loanCredit:"EVENT_LOAN_CREDIT",loanDisbursal:"EVENT_LOAN_DISBURSAL",creditCardApplication:"EVENT_CREDIT_CARD_APPLICATION"},t.EVENT_NAME_FORMAT={EVENT_PAGE_VIEW:"pageView",EVENT_ADD_PAYMENT_INFO:"addPaymentInfo",EVENT_ADD_TO_CART:"addToCart",EVENT_BUTTON_CLICK:"buttonClick",EVENT_PURCHASE:"purchase",EVENT_CONTENT_VIEW:"contentView",EVENT_DOWNLOAD:"download",EVENT_FORM_SUBMIT:"formSubmit",EVENT_INITIATED_CHECKOUT:"initiatedCheckout",EVENT_CONTACT:"contact",EVENT_PLACE_ORDER:"placeOrder",EVENT_SERACH:"search",EVENT_COMPLETE_REGISTRATION:"completeRegistration",EVENT_ADD_TO_WISHLIST:"addToWishlist",EVENT_SUBSCRIBE:"subscribe",EVENT_FIRST_DEPOSIT:"firstDeposit",EVENT_CREDIT_APPROVAL:"creditApproval",EVENT_LOAN_APPLICATION:"loanApplication",EVENT_LOAN_CREDIT:"loanCredit",EVENT_LOAN_DISBURSAL:"loanDisbursal",EVENT_CREDIT_CARD_APPLICATION:"creditCardApplication"},function(e){e.TRACK="track",e.TEST_TRACK="test_track"}(o=t.REPORT_TYPE||(t.REPORT_TYPE={})),t.KWAI_SESSION_ID="kwai_session_id",t.API=((r={})[o.TRACK]="https://www.adsnebula.com/log/common",r[o.TEST_TRACK]="",r.GET_PIXEL="https://api.mythad.com/rest/n/adintl/ad/getPixelConfig",r),t.SDK_VERSION="0.0.3",t.BROWSER_PREFIXS=["","webkit","WebKit","moz","Moz","ms","MS","o","O"],t.PRODUCTION=!0},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getUrlIn=t.writeVal=t.readVal=t.getRandom=t.getValFromCookieByName=t.getDomain=t.getSearchParams=void 0;var r=n(10);Object.defineProperty(t,"getSearchParams",{enumerable:!0,get:function(){return r.getSearchParams}});var o=n(11);Object.defineProperty(t,"getDomain",{enumerable:!0,get:function(){return o.getDomain}});var a=n(13);Object.defineProperty(t,"getValFromCookieByName",{enumerable:!0,get:function(){return a.getValFromCookieByName}});var i=n(14);Object.defineProperty(t,"getRandom",{enumerable:!0,get:function(){return i.getRandom}});var s=n(15);Object.defineProperty(t,"readVal",{enumerable:!0,get:function(){return s.readVal}}),Object.defineProperty(t,"writeVal",{enumerable:!0,get:function(){return s.writeVal}});var c=n(16);Object.defineProperty(t,"getUrlIn",{enumerable:!0,get:function(){return c.getUrlIn}})},function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.logUp=t.logErr=t.logFMP=void 0;var o=n(21),a=r(n(23)),i=new o.Weblog({env:"oversea",plugins:[new a.default({projectId:"5b88a5135h",resourceSampling:1,sampling:1})]});t.logFMP=function(){i.plugins.radar.fmp()};t.logErr=function(e){i.plugins.radar.event(e)};t.logUp=function(e){i.plugins.radar.event(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggerTypesName=void 0,t.LoggerTypesName={errConfig:"errConfig-(getPixelConfig)",errMatchPixelId:"errMatchPixelId",errUp:"errUp-(common/log)",successUp:"successUp-(common/log)",successConfig:"successConfig-(getPixelConfig)"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWorkspace=t.getWorkspaceName=void 0;var r=n(0);t.getWorkspaceName=function(){return"object"==typeof window&&window[r.KWAI_ANALYTICS_OBJECT]||r.KWAI_Q};t.getWorkspace=function(){return"object"==typeof window&&window[(0,t.getWorkspaceName)()]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.xhrService=void 0;var r=n(0),o=function(){var e=this;this.post=function(t,n){return new Promise((function(r,o){var a=new XMLHttpRequest;a.open("POST",t,!1),a.setRequestHeader("content-type","application/json");var i=e.format(n);a.onload=function(){a.status>=200&&a.status<300?r(a.response):o(a.statusText)},a.onerror=function(){return o(a.statusText)},a.withCredentials=!0,a.send(JSON.stringify(i))}))},this.format=function(e){var t=e.eventName,n=void 0===t?"":t,o=e.context,a=void 0===o?{}:o,i=e.params,s=void 0===i?{}:i,c=a.ad,u=void 0===c?{}:c,l=a.pixel,d=void 0===l?{}:l,p=a.libVersion,f=void 0===p?"":p,m=a.trackFlag,h=void 0!==m&&m;return{clickid:u.callback||"",event_name:r.EVENT_NAME[n]||r.UNKNOWN_EVENT,is_attributed:0,mmpcode:"PL",pixelId:d.code||"",pixelSdkVersion:f,testFlag:!r.PRODUCTION,trackFlag:h,pixelExtData:JSON.stringify(s)}},this.get=function(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.responseType="json",r.open("GET",e),r.onload=function(){if(r.status>=200&&r.status<300){var e=r.response;e.data&&e.data.length>0?t(e):n("pixel not exist")}else n(r.statusText)},r.onerror=function(){return n(r.statusText)},r.withCredentials=!0,r.send()}))}};t.xhrService=new o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),o=n(7),a=n(4);!function(){var e=(0,a.getWorkspace)(),t=e.initialize;if(void 0!==t&&t)e.handleCache();else{var n=new o.KwaiManager(r.SDK_VERSION),i=(0,a.getWorkspaceName)();["instance","instances","usePlugin","loadPixel","enableCookie","disableCookie"].forEach((function(t){Object.defineProperty(e,t,{get:function(){return function(){try{return n[t].apply(n,Array.prototype.slice.call(arguments))}catch(e){return{}}}},set:function(){}})})),["page","track"].forEach((function(t){Object.defineProperty(e,t,{get:function(){return function(){try{var e=Array.prototype.slice.call(arguments);return n[t].apply(n,e)}catch(e){return{}}}},set:function(){}})}));var s=Object.getPrototypeOf(n);window[i]=Object.assign(e,n,s),n.init()}}()},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.KwaiManager=void 0;var a=n(8),i=n(24),s=n(4),c=function(e){function t(t){var n=e.call(this,new a.KwaiContext(t))||this;return n.init=function(){n.context.init(),n.setPageInfo(window.location.href,document.referrer),n.handleCache()},n.handleCache=function(){var e=(0,s.getWorkspace)(),t=e._i;if(Object.entries(t).forEach((function(e){var t=e[0],r=e[1],o=!1;if(!0!==r._init&&(n.loadPixel(t),r._init=!0,o=r.length>0),o)for(;r.length;){var a=r.shift();if(a){var i=a[0],s=a.slice(1),c=n.instance(t);if(c)switch(i){case"page":n.page(s[0]);break;case"track":c.track(s[0],s[1])}}}})),e.length>0)for(;e.length;){var r=e.shift();if(r){var o=r[0],a=r.slice(1);switch(o){case"page":n.page(a[0]);break;case"track":n.track(a[0],a[1])}}}},n.createPixel=function(e){return new i.KwaiPixel(e,n.context)},n.initDynamicPlugin=function(){var e=(0,s.getWorkspace)().dynamicPlugins;(void 0===e?[]:e).forEach((function(e){try{n.useDynamicPlugin(e.handler)}catch(e){}}))},n}return o(t,e),t}(n(26).Manager);t.KwaiManager=c},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.KwaiContext=void 0;var a=n(9),i=function(e){function t(t){var n=e.call(this,t)||this;return n.init=function(){n.listenSPAHistoryChange(),n.onPageLoaded(),n.onPageLeave()},n.onPageLoaded=function(){window.addEventListener("load",(function(){n.plugins.forEach((function(e){return e.pageDidLoad()}))}),{once:!0})},n.onPageLeave=function(){window.addEventListener("beforeunload",(function(){var e=Date.now();n.plugins.forEach((function(t){return t.pageWillLeave(e)}))}),{once:!0})},n.trackSync=function(t,r,o,a){n.kwai_test_id?n.data.trackFlag=!0:n.data.trackFlag=!1,e.prototype.trackSync.call(n,t,r,o,a)},n.listenSPAHistoryChange=function(){var e=function(e,t){var n=history[e];return function(){n.apply(history,arguments),t()}},t=n.data.pageInfo.url,r=function(){var e=location.href;e!==t&&n.setPageInfo(e)};window.addEventListener("popstate",r),history.pushState=e("pushState",r),history.replaceState=e("replaceState",r)},n.kwai_test_id=(0,a.getTestId)(),n}return o(t,e),t}(n(17).Context);t.KwaiContext=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getTestId=void 0;var r=n(1),o=n(0);t.getTestId=function(){var e=(0,r.getSearchParams)(window.location.href,o.KWAI_TEST_ID)||(0,r.getSearchParams)(document.referrer,o.KWAI_TEST_ID),t=(0,r.getValFromCookieByName)(o.KWAI_TEST_ID);if(e&&e!==t){var n=(0,r.getDomain)();document.cookie=o.KWAI_TEST_ID+"="+e+"; expires=session; path=/;domain="+n}return e||t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getSearchParams=void 0;t.getSearchParams=function(e,t){try{return new URL(e).searchParams.get(t)||""}catch(e){return""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDomain=void 0;var r=n(12);t.getDomain=function(e){void 0===e&&(e=window.location.hostname);var t=e.split("."),n=t[t.length-1],o=Number.parseInt(n);if(!isNaN(o))return e;for(var a=[];t.length;){var i=t.pop();if(!i)break;if(a.unshift(i),-1===r.DOMAINS.indexOf(i))break}return"."+a.join(".")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAINS=void 0,t.DOMAINS=["ac","ad","ae","af","ag","ai","al","am","ao","aq","ar","as","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","bj","bm","bn","bo","br","bs","bt","bw","by","bz","ca","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","cr","cu","cv","cw","cx","cy","cz","de","dj","dk","dm","do","dz","ec","ee","eg","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gd","ge","gf","gg","gh","gi","gl","gm","gn","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","io","iq","ir","is","it","je","jm","jo","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mk","ml","mm","mn","mo","mp","mq","mr","ms","mt","mu","mv","mw","mx","my","mz","na","nc","ne","nf","ng","ni","nl","no","np","nr","nu","nz","om","pa","pe","pf","pg","ph","pk","pl","pm","pn","pr","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tf","tg","th","tj","tk","tl","tm","tn","to","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","ye","yt","za","zm","zw","bar","bible","biz","church","club","college","com","design","dev","download","eco","eus","google","green","hiv","icu","info","kaufen","kiwi","lat","lgbt","moe","name","net","ninja","ngo","one","ong","ooo","org","top","pro","wiki","wtf","xyz","app","aero","asia","cat","coop","edu","gov","int","jobs","mil","mobi","museum","post","tel","travel","xxx","africa","alsace","amsterdam","bcn","berlin","brussels","bzh","cymru","eu","eus","frl","gal","gent","irish","ist ","istanbul","kiwi","krd","lat","london","melbourne","miami","nyc","paris","quebec","rio","saarland","scot","sydney","taipei","tokyo","vegas","vlaanderen","wales","wien","arpa","nato","example","invalid","localhost","test","onion","bit","bitnet","csnet","exit","local","onion","root","uucp","chn","africa","bcn","wales","bzh","cym","cymru","eng","lli","sic","wales","geo","mail","web","free","kid","kids","music","bl ","bq ","eh ","mf","bv ","gb ","sj","an ","bu ","cs ","dd ","tp ","um ","yu ","zr"]},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValFromCookieByName=void 0;t.getValFromCookieByName=function(e){if(document.cookie.length>0){var t=document.cookie.indexOf(e+"=");if(-1!==t){var n=t+e.length+1,r=document.cookie.indexOf(";",n),o="";return o=-1===r?document.cookie.substring(n):document.cookie.substring(n,r),unescape(o)}}return""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRandom=void 0;t.getRandom=function(e){return e+"-"+Date.now()+"-"+(Math.floor(8999999999999*Math.random())+1e12)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.readVal=t.writeVal=void 0;t.writeVal=function(e,t){try{var n=JSON.stringify(t);window.sessionStorage.setItem(e,n)}catch(e){throw e}};t.readVal=function(e){try{var t=window.sessionStorage.getItem(e);return t?JSON.parse(t):null}catch(e){throw e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.urlParse=t.getObjIn=t.getUrlIn=void 0;t.getUrlIn=function(e,n){if(e.indexOf(n)>-1)return!0;if((e.split("?")[0].split("https://")[1]||e.split("?")[0].split("http://")[1]||e.split("?")[0])===(n.split("?")[0].split("https://")[1]||n.split("?")[0].split("http://")[1]||n.split("?")[0])){var r=(0,t.urlParse)(e),o=(0,t.urlParse)(n);return(0,t.getObjIn)(r,o)}return!1};t.getObjIn=function(e,t){var n=!0;for(var r in t)if(t[r]!==e[r]){n=!1;break}return n};t.urlParse=function(e){var t={},n=e.match(/[?&][^?&]+=[^?&]+/g);return n&&n.forEach((function(e){var n=e.substring(1).split("="),r=decodeURIComponent(n[0]),o=decodeURIComponent(n[1]);t[r]=o})),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Context=void 0;var r=n(0),o=n(18),a=n(20),i=n(1),s=n(2),c=n(3),u=function(){function e(e){var t=this;this.plugins=[],this.usePlugin=function(e){t.plugins.push(e)},this.getInitContextData=function(e){return{libVersion:e,pixelMap:{},pageInfo:{url:""},pageSign:t.initPageSign(),adInfo:t.initAdInfo()}},this.initAdInfo=function(){var e=t.browserAdService.getAdInfo();return{callback:e.callback,pixelId:e.pixelId}},this.track=function(e,n,r,o,a){if(t.data.adInfo.pixelId==e)-1==t.data.pageInfo.url.indexOf("type=preload")&&t.trackSync(e,n,r,o);else{var i=JSON.stringify({pixelId:e,urlPixelId:t.data.adInfo.pixelId,currentHref:t.data.pageInfo.url,eventName:n,params:r,ext:"页面嵌入的pixel与url里的pixel信息不一致，url里面pixelid是:"+t.data.adInfo.pixelId+"，页面pixelid是："+e+"，上报被拦截，未触发上报接口"});(0,s.logErr)({name:c.LoggerTypesName.errMatchPixelId,extra_info:i})}},this.addPixel=function(e){var n=e.pixelId;t.data.pixelMap[n]=e,t.plugins.forEach((function(t){return t.pixelDidMount(e)}))},this.getPixel=function(e){return t.data.pixelMap[e]||null},this.getAllPixels=function(){return t.pixels},this.setPageInfo=function(e,n){var r=t.data,o=r.pageInfo,a=r.pageSign;o.url!==e&&(t.plugins.forEach((function(t){return t.pageUrlWillChange(o.url,e)})),void 0!==o.url&&(o.referrer=o.url),n&&(o.referrer=n),a.pageId=(0,i.getRandom)("pageId"),o.url=e,t.plugins.forEach((function(t){return t.pageUrlDidChange(e)})))},this.getSessionIdFromCache=function(){try{return(0,i.readVal)(r.KWAI_SESSION_ID)}catch(e){return null}},this.setSessionIdToCache=function(e){try{(0,i.writeVal)(r.KWAI_SESSION_ID,e)}catch(e){}},this.initPageSign=function(){var e=t.getSessionIdFromCache();return null===e&&(e=(0,i.getRandom)(r.SESSION_ID),t.setSessionIdToCache(e)),{sessionId:e,pageId:(0,i.getRandom)(r.PAGE_ID)}},this.assemblyData=function(e,n,r){var o=t.data,a=o.pageInfo,s=o.pageSign,c=o.libVersion,u=o.adInfo,l=o.trackFlag,d=void 0!==l&&l;return{eventName:n,eventId:(0,i.getRandom)("eventId")+"-"+e,timestamp:(new Date).toJSON(),context:{ad:{callback:u.callback,pixelId:u.pixelId},pixel:{code:e},page:a,libVersion:c,trackFlag:d,sessionId:s.sessionId+"-"+e,pageViewId:s.pageId+"-"+e},params:r}},this.reportService=new a.ReportService,this.browserAdService=new o.BrowserAdService,this.data=this.getInitContextData(e)}return Object.defineProperty(e.prototype,"pixels",{get:function(){var e=this.data.pixelMap;return Object.keys(e).map((function(t){return e[t]}))},enumerable:!1,configurable:!0}),e.prototype.trackSync=function(e,t,n,o){var a=this.getPixel(e);if(null!==a){var i=this.assemblyData(e,t,n),s=r.API[o],c={pixelId:a.pixelId,accessMode:a.accessMode,currentHref:null==a?void 0:a.currentHref};s&&this.reportService.report(s,i,c)}},e}();t.Context=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserAdService=void 0;var r=n(0),o=n(1),a=n(19),i=function(){var e=this;this.params=a.paramsService,this.getAdInfo=function(){var t=(0,o.readVal)(r.KWAI_CALLBACK_SESSION_KEY);if(t)return t;var n=e.params.getAdInfo();return(n.callback||n.pixelId)&&(0,o.writeVal)(r.KWAI_CALLBACK_SESSION_KEY,n),n}};t.BrowserAdService=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.paramsService=void 0;var r=n(0),o=function(){var e=this;this.getAdInfo=function(){return{callback:e.getParamsValue(r.KWAI_CALLBACK),pixelId:e.getParamsValue(r.KWAI_PIXEL_ID)}},this.getParamsValue=function(t){var n=t.split("."),r=e.url.searchParams;if(1===n.length)return r.get(n[0])||void 0;for(var o=r.get(n[0]),a=1;a<n.length;a++){if(!o)return;o=JSON.parse(o)[n[a]]}return o||void 0},this.url=new URL(window.location.href)};t.paramsService=new o},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.ReportService=void 0;var o=n(5),a=n(2),i=n(3),s=function(){var e=this;this.xhrService=o.xhrService,this.report=function(t,n,o){e.xhrService.post(t,n).then((function(e){var t=e;"object"!=typeof e&&(t=JSON.parse(e));var s=t.result,c=t.message;if(1===s&&c){var u=JSON.stringify(r(r({},o),{data:n,message:c}));(0,a.logUp)({name:i.LoggerTypesName.successUp,extra_info:u})}})).catch((function(e){var t=JSON.stringify(r(r({},o),{data:n,error:e}));(0,a.logErr)({name:i.LoggerTypesName.errUp,extra_info:t})}))}};t.ReportService=s},function(e,t,n){!function(e){"use strict";var t,r,o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function i(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function c(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,c([console],e))}catch(e){return}}function l(e){for(var t={},n=0,r=e.split("&");n<r.length;n++){var o=r[n].split("="),a=o[0],i=o[1];a in t?t[a]instanceof Array?t[a].push(i):t[a]=[t[a],i]:t[a]=i}return t}function d(e){void 0===e&&(e=location.href);var t=e.lastIndexOf("?");return-1===t?{page:e}:{page:e.slice(0,t),params:l(e.slice(t+1))}}!function(e){e.CLICK="CLICK",e.DOUBLE_CLICK="DOUBLE_CLICK",e.TRIPLE_CLICK="TRIPLE_CLICK",e.LONG_PRESS="LONG_PRESS",e.PULL="PULL",e.DRAG="DRAG",e.SCALE="SCALE",e.PULL_DOWN="PULL_DOWN",e.PULL_UP="PULL_UP",e.AUTO="AUTO"}(t||(t={})),function(e){e.PV="PV",e.SHOW="SHOW",e.VIDEO="VIDEO",e.CUSTOM="CUSTOM",e.CUSTOM_EVENT="CUSTOM_EVENT",e.RADAR="RADAR"}(r||(r={}));var p,f=(p="",function(){if(p)return p;try{var e=window.devicePixelRatio||1,t=Math.floor(screen.width*e),n=Math.floor(screen.height*e);return p=t+"x"+n}catch(e){return""}});function m(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&window.history&&"pushState"in window.history}var h={},g=function(e){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var t=Number(function(e){try{if(window&&window.localStorage){var t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}}}catch(e){return null}return null}(e))||0;return t+1>1e8&&(t=0),function(e,t){try{window&&window.localStorage&&window.localStorage.setItem(e,JSON.stringify(t))}catch(e){return!1}}(e,t+1),t}}catch(e){}return h[e]||(h[e]=0),h[e]++};function v(e,t,n){var r={};if(e.length>0)for(var o=t?decodeURIComponent:function(e){return e},a=e.split(/;\s/g),i=null,s=null,c=null,u=0,l=a.length;u<l;u++){if(null!==(c=a[u].match(/([^=]+)=/i)))try{i=decodeURIComponent(c[1]),s=o(a[u].substring(c[1].length+1))}catch(e){}else i=decodeURIComponent(a[u]),s="";null!==i&&(r[i]=s)}return r}var y,_={};function S(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1);try{if(!n&&e in _)return _[e];if(!(null===window||void 0===window?void 0:window.document))return;var r=document.cookie||"";return r===y?_[e]:(y=r,(_=v(r,!t.raw))[e])}catch(e){}}var w,b={getCookie:S,setCookie:function(e,t,n){void 0===n&&(n={});try{document.cookie=function(e,t,n,r){void 0===r&&(r={});var o=encodeURIComponent(e)+"="+(n?encodeURIComponent(t):t),a=r.expires,i=r.path||"/",s=r.domain||"";return a instanceof Date&&(o+="; expires="+a.toUTCString()),"number"==typeof a&&(o+="; max-age=="+a),""!==i&&(o+="; path="+i),""!==s&&(o+="; domain="+s),!0===r.secure&&(o+="; secure"),o}(e,t,!n.raw,n),_[e]=t}catch(e){}},parseCookieString:v},E=function(e,n,r,o){void 0===e&&(e=t.CLICK),void 0===n&&(n={}),"string"!=typeof e&&(e=e.type),e=e.toUpperCase();var a={};return"string"==typeof n?(a.contentPackage=o,"CUSTOM"===e?(a.key=n,a.value=r):(a.params=r,"PV"===e?a.page=n:a.action=n)):a=n,[e,a]},k=null,P="tool",O=!1,T=function(e){return void 0===e&&(e=w||"undefined"!=typeof window&&window.yoda),w&&w.isInYoda?w:e&&e.isInYoda?w=e:null},I=function(){return i(void 0,void 0,void 0,(function(){return s(this,(function(e){switch(e.label){case 0:if(!w||O)return[2];e.label=1;case 1:return e.trys.push([1,6,,7]),k?[4,k]:[3,3];case 2:return e.sent(),[3,5];case 3:return[4,k=w.ready()];case 4:e.sent(),w.register({namespace:"webview",name:"getPageLoadData"}),w.register({namespace:"tool",name:"setClientLog"}),w.register({namespace:"tool",name:"sendRadarLog"}),w.register({namespace:"tool",name:"sendSummarizedLog"}),w.register({namespace:"tool",name:"getKswitchData"}),e.label=5;case 5:return k=null,O=!0,[3,7];case 6:return e.sent(),[3,7];case 7:return[2]}}))}))},x=function(e,t){return void 0===t&&(t="tool"),i(void 0,void 0,void 0,(function(){var n,r,o;return s(this,(function(a){switch(a.label){case 0:return n=!1,w?O?[3,2]:[4,I()]:[3,5];case 1:a.sent(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,w.tool.canIUse({namespace:t,name:e})];case 3:return r=a.sent().canUse,n=r,[3,5];case 4:return o=a.sent(),u("[error 206]","yoda.tool.canIUse({ '"+t+"', '"+e+"' }) 报错: "+o.message),[3,5];case 5:return[2,n]}}))}))},C=function(e,t){return i(void 0,void 0,void 0,(function(){var n;return s(this,(function(r){switch(r.label){case 0:return w?O?[3,2]:[4,I()]:[2];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,,5]),[4,w[P].setClientLog({type:e,data:t},(function(n,r){n&&1!==n.result&&u("[error 203]","yoda.tool.setClientLog 埋点发送失败",JSON.stringify({type:e,data:t}),"result: "+n+", message: "+r)}))];case 3:return[2,r.sent()];case 4:return n=r.sent(),u("[error 209]","yoda."+P+".setClientLog() 报错: "+n.message),[3,5];case 5:return[2]}}))}))},L={isSupportBridgeLog:function(){return i(void 0,void 0,void 0,(function(){var e;return s(this,(function(t){switch(t.label){case 0:return w?[4,x(e="setClientLog","tool")]:[2,!1];case 1:return t.sent()?(P="tool",[2,!0]):[4,x(e,"platform")];case 2:return t.sent()?(P="platform",[2,!0]):[2,!1]}}))}))},isSupportBridge:x,getWebviewLoadPerf:function(e){return void 0===e&&(e={}),i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return w?O?[3,2]:[4,I()]:[2];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,null===(t=w.webview)||void 0===t?void 0:t.getPageLoadData(e)];case 3:return[2,n.sent()];case 4:return u("[error 207]","yoda.webview.getPageLoadData() 报错: "+n.sent().message),[3,5];case 5:return[2]}}))}))},sendRadarLog:function(e){return void 0===e&&(e={}),i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return w?O?[3,2]:[4,I()]:[2];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,4,,5]),[4,null===(t=w.tool)||void 0===t?void 0:t.sendRadarLog(e,(function(t,n){t&&1!==t.result&&u("[error 205]","yoda.tool.sendRadarLog 埋点发送失败",JSON.stringify(e),"result: "+t+", message: "+n)}))];case 3:return[2,n.sent()];case 4:return u("[error 207]","yoda.tool.sendRadarLog() 报错: "+n.sent().message),[3,5];case 5:return[2]}}))}))},setClientLog:C,initYoda:I,yodaAlready:O,getKDSWebviewLoadPerf:function(e){return void 0===e&&(e={}),i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:return w?O?[3,2]:[4,I()]:[2];case 1:n.sent(),n.label=2;case 2:return[4,x("getPageLoadData","system")];case 3:if(!n.sent())return[3,7];n.label=4;case 4:return n.trys.push([4,6,,7]),[4,null===(t=w.system)||void 0===t?void 0:t.getPageLoadData(e)];case 5:return[2,n.sent()];case 6:return u("[error 212]","yoda.system.getPageLoadData() 报错",n.sent().message),[3,7];case 7:return[2]}}))}))},sendSummarizedLog:function(e){return void 0===e&&(e={}),i(void 0,void 0,void 0,(function(){var t;return s(this,(function(n){switch(n.label){case 0:if(!w)return[2];n.label=1;case 1:return n.trys.push([1,5,,6]),O?[3,3]:[4,I()];case 2:n.sent(),n.label=3;case 3:return[4,null===(t=w.tool)||void 0===t?void 0:t.sendSummarizedLog(e)];case 4:return[2,n.sent()];case 5:return u("[error 208]","yoda.tool.sendSummarizedLog() 报错: "+n.sent().message),[3,6];case 6:return[2]}}))}))}},N=function(e,t,n){return u("[error 400]","埋点上报接口请求报错","\nurl:",t,"\ndata",n,"\nerror:",e||"server decode log failed")};function R(e,t){var n=e.url,r=e.data,o=e.timeout,a=new XMLHttpRequest;a.open("POST",n),a.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),"object"!=typeof r||r instanceof Uint8Array||(r=JSON.stringify(r)),o&&(a.timeout=o),a.onload=function(){var e=function(e,t,n,r){var o;if(e<200||e>=300&&304!==e);else try{var a=JSON.parse(t),i=a.exception,s=a.result,c=a.error_msg;i&&(o=i),1!==s&&(o=c||"result is "+s)}catch(e){o=e.message}return o&&N(o,n,r),o}(a.status,a.response,n,r);t&&t(e)},a.ontimeout=a.onerror=function(e){e&&N(e,n,r),t&&t(e?"networkTimeout":"")},a.send(r)}var A,D,j=function(e){function t(t,n,r){var o=e.call(this,{},n)||this;if("string"==typeof t){var a=d(t);o.page=a.page,o.params=a.params}else o.page=(t||{}).page||"",o.params=(t||{}).params||void 0;return o.identity=o.generatePageId(),r&&"string"==typeof t&&o.init(t,r),o}return function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.init=function(e,t){void 0===t&&(t={});var n=function(e,t){var n=e.url,r=e.page,o=e.params,a=e.pageId;if(!r&&"string"==typeof n){var i=d(n);r=i.page,o=i.params}if("function"==typeof t)try{var s=t({url:n,page:r,params:o});"string"==typeof s?r=s:"object"==typeof s&&(s.page&&(r=s.page),s.params&&(o=s.params),s.pageId&&(a=s.pageId))}catch(e){}else if("object"==typeof t){var c="";for(var u in t)if((n||r||"").indexOf(u)>-1){c=t[u];break}c&&(r=c)}return{page:r,params:o,pageId:a}}({url:e,page:this.page,params:this.params},t),r=n.page,o=n.params;this.update(r,o)},t.prototype.attachUrl=function(){if(this.params||(this.params={}),null===location||void 0===location?void 0:location.href){this.params.origin_url=this.params.origin_url||(null===location||void 0===location?void 0:location.href);var e=d(location.href).page,t=void 0===e?"":e;this.params.origin_pathname=t}},t.prototype.getRealUrlPackage=function(){var e=d(location.href),t=e.page,n=e.params;return{page:t,params:JSON.stringify(a({page_code:this.page,url:location.href,query:n},n)),page_type:this.page_type,identity:this.identity}},t.prototype.generatePageId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},t}(function(){function e(e,t){switch(this.page="",this.identity="",t){case"web":this.page_type=2;break;case"native":this.page_type=1;break;case"mina":this.page_type=3;break;default:this.page_type=0}this.update(e.page,e.params)}return e.prototype.update=function(e,t){void 0===e&&(e=""),e&&e!==this.page&&(this.page=e,this.identity=this.generatePageId(e)),t&&(this.params=Object.assign(this.params||{},t))},e.prototype.toJSON=function(){return{page:this.page,identity:this.identity,page_type:this.page_type,params:JSON.stringify(this.params)}},e.prototype.generatePageId=function(e){return e+(new Date).getTime()},e}()),U=null===(A=null===window||void 0===window?void 0:window.navigator)||void 0===A?void 0:A.platform,M=U&&-1!==["iOS","Android"].indexOf(U),V=0;try{var K=n(22);D=T(K.default||K)}catch(e){D=T("undefined"!=typeof window&&window.yoda)}var W=function(){function e(e,t){this.version="3.9.50",this.plugins={},this.yoda=D,this.entered="",this.logConfig=e,this.baseOption=t,this.commonPackage=new B(t),this.updateCurrentUrlPackage(),this.addPlugins()}return Object.defineProperty(e.prototype,"Utils",{get:function(){return{yoda:this.yoda&&L,cookie:b,ua:{getDefaultKpn:function(){return S("kpn")},supportsPushState:m},io:{sendData:R}}},enumerable:!1,configurable:!0}),e.prototype.addPlugins=function(){var e=this;this.logConfig.plugins&&this.logConfig.plugins.length&&this.logConfig.plugins.forEach((function(t){"object"==typeof t&&"function"==typeof t.apply&&e.addPluginInstance(t)}))},e.prototype.addPluginInstance=function(e){if(e){var t=e.key||e.constructor&&e.constructor.key||"plugin_auto_key_"+V++;"function"!=typeof e.apply||e.weblog&&e.weblog===this||e.apply(this),this.plugins[t]=e}},e.prototype.plug=function(e,t){if(this.plugins[e.key])return u("[code 301]",e.key+" 插件重复加载！");this.addPluginInstance(new e(this,t))},e.prototype.collect=function(e,t,n,r){var o=E(e,t,n,r),a=o[0],i=o[1];return this.send(a,i,!1)},e.prototype.sendImmediately=function(e,t,n,r){var o=E(e,t,n,r),a=o[0],i=o[1];return this.send(a,i,!0)},e.prototype.beforeSend=function(e,t){var n;if("CLICK"===e){var r=null===(n=t)||void 0===n?void 0:n.entryTag;if(this.yoda&&r)try{!function(e,t){i(void 0,void 0,void 0,(function(){var n,r;return s(this,(function(o){switch(o.label){case 0:return w?O?[3,2]:[4,I()]:[2];case 1:o.sent(),o.label=2;case 2:return o.trys.push([2,4,,5]),[4,null===(r=w.tool)||void 0===r?void 0:r.handleEntryTag({type:e,params:t})];case 3:return(n=o.sent())&&n.data&&n.data.entryTag?[2,n.data.entryTag]:[3,5];case 4:return u("[error 213]","操作染色参数报错",o.sent()),[3,5];case 5:return[2,null]}}))}))}("setPendingEntryTag",{entryTag:a({page_name:this.currentUrlPackage.page,element_action:null==t?void 0:t.action},r)})}catch(e){u("[error 312]","操作染色参数报错",e)}}},e.prototype.send=function(e,n,o){void 0===e&&(e=t.CLICK),void 0===n&&(n={}),e=e.toUpperCase(),this.beforeSend(e,n);var i=n,s=i.contentPackage,c=i.disablePV;if(s&&(s="string"==typeof s?s:JSON.stringify(s)),e===r.PV){var l=n,d=l.page,p=l.type,f=l.params,m=l.coPage;p||(n.type=p="enter"),"enter"===p?((d=d||this.currentUrlPackage.page)&&(this.updateCurrentUrlPackage({page:d,params:f||this.currentUrlPackage.params,force:!0}),this.entered=d),m&&(this.currentUrlPackage.coPage=m)):this.currentUrlPackage.update(d,f)}var h=!!this.currentUrlPackage.coPage,g=function(e,t){var n=t,r=n.action,o=n.params,i=n.eventId,s=n.contentPackage,c=n.currentUrlPackage,u=n.status;n.name;var l=n.feedLogCtx;switch(e){case"PV":var d=t,p=d.type,f=d.beginTime;return a(a({},c),{actionType:p,contentPackage:s,pageType:"H5",status:u||"SUCCESS",beginTime:f,eventId:i});case"SHOW":return{action:r,params:JSON.stringify(o),contentPackage:s,feedLogCtx:l,eventId:i};case"RADAR":case"CUSTOM":var m=t,h=m.key,g=m.value,v=m.biz;return{key:h,value:JSON.stringify(a(a({},g),{url_package:c})),biz:v,eventId:i};default:var y=t.type;return{action:r,params:JSON.stringify(o),contentPackage:s,type:y||"USER_OPERATION",status:u||"UNKNOWN_STATUS",operationType:e,operationDirection:"UNKNOWN2",feedLogCtx:l,eventId:i}}}(e,a(a({},n),{contentPackage:s,currentUrlPackage:this.currentUrlPackage.toJSON()})),v=-1!==[r.CUSTOM,r.RADAR,r.CUSTOM_EVENT].indexOf(e);this.commonPackage.increaseH5SeqId(v);var y=this.baseOption||{},_=y.service_name,S=y.sub_biz,w=y.need_encrypt;if(g.h5ExtraAttr=JSON.stringify(this.commonPackage.getH5ExtraAttr({bridge_info:(null==D?void 0:D.version)||!0,coPage:h})),g.realtime=!!o,g.serviceName=_||"",g.subBiz=S||"",g.needEncrypt=w||!1,g.container=M?"REACT_NATIVE":"H5",g.coPage=h,e!==r.PV){if(!this.currentUrlPackage||this.logConfig.disablePV||c||(g.urlPage={page:this.currentUrlPackage.page,params:JSON.stringify(this.currentUrlPackage.params),identity:this.currentUrlPackage.identity,coPage:h}),e===r.SHOW)return C("addElementShowEvent",g);if(v){this.logConfig.biz&&!g.biz&&(g.biz=this.logConfig.biz);var b=this.logConfig.customStatToCustom||e===r.CUSTOM_EVENT;return C(b?"addCustomEvent":"addCustomStatEvent",g)}return C("addTaskEvent",g)}this.logConfig.disablePV||function(e){return!e||!/^(https?:)?\/\//.test(e)||(u("[error 108]","请注意当前埋点页面信息为 "+e+"，不符合规范，上报失败！"),!1)}(this.currentUrlPackage.page)&&("enter"!==(p=n.type)&&"visible"!==p||(g.pageType=M?"NATIVE":"H5",C("setCurrentPage",g)))},e.prototype.updateCurrentUrlPackage=function(e,t){if(void 0===e&&(e="undefined"!=typeof location?location.href:""),void 0===t&&(t="web"),"object"==typeof e&&!e.force&&this.currentUrlPackage){var n=e.page,r=void 0===n?this.currentUrlPackage.page:n,o=e.params,a=void 0===o?{}:o;if(!r||r===this.currentUrlPackage.page)return this.entered===r?void this.send("PV",{type:"visible",page:r,params:a},!0):void this.currentUrlPackage.update(r,a)}this.currentUrlPackage=new j(e,t,this.logConfig.urlMap),this.logConfig.attachUrl&&this.currentUrlPackage.attachUrl()},e.prototype.updateReferUrlPackage=function(e,t){void 0===e&&(e=this.currentUrlPackage),void 0===t&&(t="web"),this.referUrlPackage=e instanceof j?e:new j(e,t,this.logConfig.urlMap)},e.prototype.flush=function(){},e.prototype.on=function(){},e.prototype.emit=function(){},e.prototype.updateCommonPackage=function(e){(null==e?void 0:e.h5_extra_attr)&&Object.assign(this.commonPackage.h5_extra_attr,e.h5_extra_attr)},e}(),B=function(){function e(e){this.h5_extra_attr={sdk_name:"webLogger",sdk_version:"3.9.50",sdk_bundle:"log.bridge.js",host_product:S("kpn"),resolution:f(),domain:window.location.origin,app_version_name:S("appver")||""},this.app_package={version_name:this.h5_extra_attr.app_version_name,container:M?"REACT_NATIVE":"H5"},Object.assign(this.h5_extra_attr,null==e?void 0:e.h5_extra_attr)}return e.prototype.increaseH5SeqId=function(e){this.h5_extra_attr.client_timestamp=function(e){try{return Math.abs(Math.floor(e))}catch(t){return e}}(Date.now()),this.h5_extra_attr.seq_id=g(e?"WEBLOGGER_H5_CUSTOM_SEQ_ID":"WEBLOGGER_H5_SEQ_ID")},e.prototype.getH5ExtraAttr=function(e){return Object.assign({},this.h5_extra_attr,e)},e}(),F=function(){function e(){}return e.prototype.apply=function(e){this.weblog=e},e}();"undefined"!=typeof window&&(void 0!==window._GLOBAL_KS_WEBLOGGER_?window._GLOBAL_KS_WEBLOGGER_.Factory=W:window.Weblog=W),e.BasePlugin=F,e.Weblog=W,e.default=W,Object.defineProperty(e,"__esModule",{value:!0})}(t)},function(e,t,n){"use strict";var r,o=new Promise((function(e){r=e}));function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var u=[{namespace:"system",name:"getDeviceInfo"},{namespace:"system",name:"getAppInfo"},{namespace:"system",name:"getNetworkType"},{namespace:"webview",name:"open"},{namespace:"webview",name:"getLaunchParams"},{namespace:"webview",name:"close"},{namespace:"webview",name:"backOrClose"},{namespace:"tool",name:"canIUse"},{namespace:"tool",name:"checkAppInstalled"},{namespace:"tool",name:"launchApp"},{namespace:"ui",name:"setTopBarStyle"},{namespace:"ui",name:"setTitle"},{namespace:"ui",name:"setTopBarButton"},{namespace:"ui",name:"removeTopBarButton"},{namespace:"ui",name:"setSlideBackBehavior"},{namespace:"ui",name:"setPhysicalBackButtonBehavior"},{namespace:"ui",name:"showLoading"},{namespace:"ui",name:"hideLoading"},{namespace:"ui",name:"showToast"},{namespace:"ui",name:"showDialog"},{namespace:"event",name:"addEventListener"},{namespace:"event",name:"removeEventListener"},{namespace:"event",name:"dispatchEvent"}],l=navigator.userAgent.indexOf(" Android ")>-1,d={"tool.checkAppInstalled":{before:function(e){return{identifier:e[l?"android":"ios"]}}}};function p(e,t,n){if(t.__yodaCallbackId__)throw new Error("addEventListener 的 listener 已经被绑定过了");this._callbackId++,this._callbacks[this._callbackId]=t;var r=this._eventListeners[e];return r||(r=this._eventListeners[e]={}),r[this._callbackId]=!0,t.__yodaCallbackId__=""+this._callbackId,this.event._addEventListener({type:e,listener:t.__yodaCallbackId__},n)}function f(e,t,n){var r,o=this,a=this._eventListeners[e];if(t&&!((r=t.__yodaCallbackId__)&&a&&a[r])){var i=Promise.resolve({result:1});return n&&i.then(n),i}var s=this.event._removeEventListener({type:e,listener:r},n);return s.then((function(e){if(1===e.result)if(t)delete a[r],delete t.__yodaCallbackId__,delete o._callbacks[r];else if(a)for(var n in delete o._eventListeners[name],a)delete o._callbacks[n].__yodaCallbackId__,delete o._callbacks[n]})),s}function m(e){e.event.addEventListener&&(e.event._addEventListener=e.event.addEventListener,e.event.addEventListener=p.bind(e)),e.event.removeEventListener&&(e.event._removeEventListener=e.event.removeEventListener,e.event.removeEventListener=f.bind(e))}var h={version:"0.2.1",isInYoda:!!window.__yodaBridge__,_callbackId:1,_callbacks:{},_eventListeners:{},_readyPromise:o,_readyResolve:r,ready:function(e){return e&&o.then(e),o}};h.plugin=function(e,t){e._plugins=[];var n=function(n){var r=t[n],o=n[0].toUpperCase()+n.slice(1),i="before"+o,s="after"+o;e[n]=function(t){var n=e._plugins,o=n.length,c=-1;!function u(){for(;++c<o;){var l=n[c][i];if("function"==typeof l){var d=function(){var n=void 0;return l.call(e,t,(function(){n||(n=!0,u())})),{v:void 0}}();if("object"===a(d))return d.v}}r.call(e,t);for(var p=0;p<o;p++){var f=n[p][s];"function"==typeof f&&f.call(e,t)}}()}};for(var r in t)n(r);return function(t){"function"==typeof t&&(t=new t(e)),e._plugins.push(t)}}(h,{register:function(e){var t=this;if(!(e&&e.namespace&&e.name))throw new Error("register 参数： {namespace, name}");var n=this[e.namespace];n||(n=this[e.namespace]={}),n[e.name]=function(n,r,o){n=n||{},o||"function"!=typeof r||(o=r,r=null),r=r||{},o=o||function(){},e.before&&(n=e.before(n));var a,i,s=++t._callbackId;if(e.multiCallback||r.multiCallback?i=o:((a=new Promise((function(e){return i=e}))).then((function(){delete t._callbacks[s]})),a.then(o)),e.after){var c=i;i=function(t){return c(e.after(t))}}t._callbacks[s]=i;try{t.invoke({namespace:e.namespace,name:e.name,params:n,callbackId:s})}catch(e){i({result:125014,message:e.message})}return a}},invoke:function(e){var t=e.namespace,n=e.name,r=e.params,o=e.callbackId;window.__yodaBridge__.invoke(t,n,JSON.stringify(r),""+o)},callbackHandler:function(e){var t=e.id,n=e.params,r=this._callbacks[t];r&&r(n)},init:function(){var e=this,t=function(){e.register({namespace:"tool",name:"getApiList"}),e.tool.getApiList({},(function(t){var n=t.result,r=t.apiList;1!==n&&(r=u);for(var o=r.length;o--;){var a=r[o],i=d[a.namespace+"."+a.name];i&&(a=c({},a,{},i)),e.register(a)}m(e),e._readyResolve()}))};window.__yodaBridge__?t():window.__yodaBridgeReady__=t}}),window.__yodaBridgeCallback__=function(e,t){h.callbackHandler({id:e,params:t})},setTimeout((function(){return h.init()})),e.exports=h},function(e,t,n){e.exports=function(){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};function t(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function r(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}function o(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))}function a(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function i(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),o=0;for(t=0;t<n;t++)for(var a=arguments[t],i=0,s=a.length;i<s;i++,o++)r[o]=a[i];return r}function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.warn;return n&&n.call.apply(n,i([console],e))}catch(e){return}}function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{var n=null===console||void 0===console?void 0:console.error;return n&&n.call.apply(n,i([console],e))}catch(e){return}}function u(e,t,n,r){return"attachEvent"in e?e.attachEvent("on"+t,n):e.addEventListener(t,n,r)}function l(e,t,n,r){return"attachEvent"in e?e.detachEvent("on"+t,n):e.removeEventListener(t,n,r)}function d(e){for(var t={},n=0,r=e.split("&");n<r.length;n++){var o=r[n].split("="),a=o[0],i=o[1];a in t?t[a]instanceof Array?t[a].push(i):t[a]=[t[a],i]:t[a]=i}return t}function p(e){var t="";if("string"==typeof e)t=e;else try{t=JSON.stringify(e)}catch(n){t=String(e)}for(var n=0,r=0;r<t.length;r++){var o=t.charCodeAt(r);n+=o<128?1:o<2048?2:o<65536?3:o<1<<21?4:o<1<<26?5:o<1<<31?6:Number.NaN}return n}var f,m,h,g=function(){function e(){}return e.prototype.apply=function(e){this.weblog=e},e}(),v=function(){var e="undefined"!=typeof window?window.performance:null;if(e&&e.timing){if("function"==typeof e.timing.toJSON){var t=e.timing.toJSON();return t&&!t.redirectStart&&(t.redirectStart=t.navigationStart),t}return e.timing}return null},y="radar_log";!function(e){e.LOAD="load",e.RES="resource",e.API="api",e.ERROR="error",e.SDK_ERROR="sdk_error",e.CUSTOM="custom",e.BATCH="batch",e.EVENT="event"}(f||(f={})),function(e){e.LOAD="load_statistics",e.RES="resource_statistics",e.API="api_statistics",e.ERROR="error_statistics",e.SDK_ERROR="sdk_error",e.CUSTOM="custom_statistics"}(m||(m={})),function(e){e.SCRIPT="script",e.RES="res",e.API="api",e.VIDEO="video"}(h||(h={}));var _,S,w={redirect:{end:"fetchStart",start:"navigationStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(e,t){return t.redirectCount}},ssl:{custom:function(e,t){return 0===t.secureConnectionStart?0:t.connectEnd-t.secureConnectionStart}},ssl_start:{custom:function(e,t){return 0===t.secureConnectionStart?0:t.secureConnectionStart-t.redirectStart}},ttfb:{end:"responseStart",start:"requestStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domContentLoadedEventEnd"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var e=performance.getEntries().filter((function(e){return"first-paint"===e.name}))[0];return e?Math.ceil(e.startTime+e.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var e=v(),t=performance.getEntries(),n=performance.getEntries().filter((function(e){return"navigation"===e.initiatorType}))[0],r=t.filter((function(e){return"script"===e.initiatorType}))[0],o=n?n.domComplete:e.domComplete-e.navigationStart;return r&&o?o-r.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(e,t){return t.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document?document.all.length:null}}},b={fetch_start:{custom:function(e,t){return Math.round(t.fetchStart)}},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(e,t){return 0===t.secureConnectionStart?0:t.connectEnd-t.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},duration:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(e,t){return t.encodedBodySize},noThrottle:!0},protocol:{custom:function(e,t){return t.nextHopProtocol}},file:{custom:function(e,t){return t.name},noThrottle:!0},res_type:{custom:function(e,t){return t.initiatorType}},cached:{custom:function(e,t){return 0===t.transferSize||null==t.transferSize&&0===t.domainLookupStart},noThrottle:!0}},E={fetch_start:{custom:function(e,t){return Math.round(t.fetchStart)},noThrottle:!0},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(e,t){return 0===t.secureConnectionStart?0:t.connectEnd-t.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},duration:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(e,t){return t.encodedBodySize},noThrottle:!0},protocol:{custom:function(e,t){return t.nextHopProtocol}},file:{custom:function(e,t){return t.name},noThrottle:!0},res_type:{custom:function(e,t){return t.initiatorType}},cached:{custom:function(e,t){return 0===t.transferSize||null==t.transferSize&&0===t.domainLookupStart},noThrottle:!0}},k=["//wlog.kuaishou.com/rest/n/log/web/collect","/rest/wd/common/log/collect/misc2","/rest/wd/common/log/collect/radar","/rest/kd/log/collect"],P={to_webview_page_start:{end:"pageStart",start:"userStart"},to_webview_page_show:{end:"pageShow",start:"userStart"},to_webview_pre_create:{end:"preCreate",start:"userStart"},to_webview_created:{end:"created",start:"userStart"},to_webview_start_load:{end:"startLoad",start:"userStart"},to_webview_did_start_load:{end:"didStartLoad",start:"userStart"},to_webview_did_end_load:{end:"didEndLoad",start:"userStart"},to_navigation_start:{end:"navigationStart",start:"userStart"},to_fetch_start:{end:"fetchStart",start:"userStart"},to_connect_start:{end:"connectStart",start:"userStart"},to_dom_ready:{end:"domContentLoadedEventEnd",start:"userStart"},to_total:{end:"loadEventStart",start:"userStart"},to_fmp:{end:"radarFmp",start:"userStart",notCatchIfUndefined:!0},to_main_data_receive_end:{end:"main_data_receive_end",start:"userStart",notCatchIfUndefined:!0}},O={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connectStart",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",fmp_time:"radarFmp"},T=function(){return"".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12)},I=function(e){return{name:e,value:arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,delta:0,entries:[],id:T(),isFinal:!1}},x=function(e,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var n=new PerformanceObserver((function(e){return e.getEntries().map(t)}));return n.observe({type:e,buffered:!0}),n}}catch(e){}},C=!1,L=!1,N=function(e){C=!e.persisted},R=function(){addEventListener("pagehide",N),addEventListener("beforeunload",(function(){}))},A=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];L||(R(),L=!0),addEventListener("visibilitychange",(function(t){var n=t.timeStamp;"hidden"===document.visibilityState&&e({timeStamp:n,isUnloading:C})}),{capture:!0,once:t})},D=function(e,t,n,r){var o;return function(){n&&t.isFinal&&n.disconnect(),t.value>=0&&(r||t.isFinal||"hidden"===document.visibilityState)&&(t.delta=t.value-(o||0),(t.delta||t.isFinal||void 0===o)&&(e(t),o=t.value))}},j=function(){return void 0===_&&(_="hidden"===document.visibilityState?0:1/0,A((function(e){var t=e.timeStamp;return _=t}),!0)),{get timeStamp(){return _}}},U=function(){return S||(S=new Promise((function(e){return["scroll","keydown","pointerdown"].map((function(t){addEventListener(t,e,{once:!0,passive:!0,capture:!0})}))}))),S},M=/^(https?:)?\/\//;function V(e){return"number"==typeof e?e.toFixed():e}function K(e){if("string"!=typeof e)return"";try{var t=e.lastIndexOf(".");return e.substr(t+1)}catch(e){return""}}function W(e,t){if(!e)return!1;var n=e.replace(M,"");return t.some((function(e){return n.indexOf(e)>=0}))}var B={};function F(e,t){var n=B[e];n?n.endTime||(n.endTime=(new Date).getTime(),n.duration=n.endTime-n.startTime,delete n.startTime,delete n.endTime):B[e]={startTime:(new Date).getTime()}}var q={},H=[{name:"fid",collectFn:function(e){var t=I("FID"),n=j(),r=function(e){e.startTime<n.timeStamp&&(t.value=e.processingStart-e.startTime,t.entries.push(e),t.isFinal=!0,a())},o=x("first-input",r),a=D(e,t,o);o?A((function(){o.takeRecords().map(r),o.disconnect()}),!0):window.perfMetrics&&window.perfMetrics.onFirstInputDelay&&window.perfMetrics.onFirstInputDelay((function(e,r){r.timeStamp<n.timeStamp&&(t.value=e,t.isFinal=!0,t.entries=[{entryType:"first-input",name:r.type,target:r.target,cancelable:r.cancelable,startTime:r.timeStamp,processingStart:r.timeStamp+e}],a())}))}},{name:"lcp",collectFn:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=I("LCP"),o=j(),a=function(e){var n=e.startTime;n<o.timeStamp?(r.value=n,r.entries.push(e)):r.isFinal=!0,t()},i=x("largest-contentful-paint",a);if(i){t=D(e,r,i,n);var s=function(){r.isFinal||(i.takeRecords().map(a),r.isFinal=!0,t())};U().then(s),A(s,!0)}}},{name:"cls",collectFn:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=I("CLS",0),o=function(e){e.hadRecentInput||(r.value+=e.value,r.entries.push(e),t())},a=x("layout-shift",o);a&&(t=D(e,r,a,n),A((function(e){var n=e.isUnloading;a.takeRecords().map(o),n&&(r.isFinal=!0),t()})))}},{name:"fcp",collectFn:function(e){var t,n=I("FCP"),r=j(),o=x("paint",(function(e){"first-contentful-paint"===e.name&&e.startTime<r.timeStamp&&(n.value=e.startTime,n.isFinal=!0,n.entries.push(e),t())}));o&&(t=D(e,n,o))}}],z=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];1==+d(location.search.slice(1)).debug&&s.apply(void 0,i(["[radar] "+e+": "],t))},J=function(){var e=window.navigator.userAgent,t={};return e.split(" ").map((function(e){var n=e.split("/");t[n[0]]=n[1]})),t},Y=function(){var e=window.navigator.userAgent;if(-1!==e.indexOf("Android"))return"WebView";if(-1!==e.indexOf("iPhone")){var t=J();return t.Yoda&&"WK"===t.WebViewType?"YodaWKWebView":t.Yoda||"WKWebView"!==t.WebView?"UIWebView":"WKWebView"}return""},G=function(e,t){var n={};return Object.keys(t).forEach((function(r){e[t[r]]>=0&&(n[r]=V(e[t[r]]))})),n};function Q(e){return Array.isArray(e)?e.map((function(e){var t=e.tagName,n=void 0===t?"":t,r=e.id,o=e.getAttribute?e.getAttribute("class"):e.className||"",a=n.toLowerCase();return r&&(a+="#"+r),o&&(a+=o.split(/\s+/g).map((function(e){return"."+e})).join("")),a})).filter((function(e){return e})).join(","):""}function X(e){return JSON.parse(JSON.stringify(e))}var $=function(e){try{if(window&&window.localStorage&&"undefined"!=typeof Storage&&window.localStorage instanceof Storage){var t=Number(function(e){try{if(window&&window.localStorage){var t=window.localStorage.getItem(e);if(t)try{return JSON.parse(t)}catch(e){return t}}}catch(e){return null}return null}(e))||0;return t+1>1e8&&(t=0),function(e,t){try{window&&window.localStorage&&window.localStorage.setItem(e,JSON.stringify(t))}catch(e){return!1}}(e,t+1),t}}catch(e){}},Z={},ee=function(e){return Z[e]||(Z[e]=0),Z[e]++};function te(e){if(!(null==e?void 0:e.name))throw new Error("[Radar] 关键动作上报必须配置name");if((null==e?void 0:e.extra_info)&&!(e.extra_info instanceof Object))throw new Error("[Radar] 关键动作上报 extra_info 必须为 plain object")}function ne(e,t){if(!Array.isArray(t))return-1;var n=-1;return t.forEach((function(t,r){new RegExp(t).test(e)&&(n=r)})),n}var re,oe,ae=function(){function e(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.middlewares=[],(e=this.middlewares).push.apply(e,t)}return e.prototype.use=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=this.middlewares.pop();(e=this.middlewares).push.apply(e,t),this.middlewares.push(r)},e.prototype.invoke=function(e){var t;return(t=this.middlewares,function(e,n){var r=-1;return function o(a){if(a<=r)return new Error("`next` 被重复调用");r=a;var i=t[a];if(a===t.length&&(i=n),i)try{return i(e,o.bind(null,a+1))}catch(e){return e}}(0)})(e)},e}(),ie=["KUAISHOU","THANOS","NEBULA"],se=function(e){function r(t,r){var o,a,s=e.call(this)||this;return s.kpn="",s.plugins=[],s.logQueue=[],s.logQueueNext=[],s.queueConfig={wait:1e3,maxBatchLength:200},s.eventName="onpagehide"in window?"pagehide":"beforeunload",s.batchTimer=0,s.batchTimerNext=0,s.startedLoadReport=!1,s.radarSessionId="",s.radarSessionIdNext="",s.chromeMetric=H,s.isInKwai=!1,s.isUsingBridge=null,s.isUsingLegacy=null,s.isUsingDetachedReport=null,s.isSupportedYodaConcat=null,s.customDimension={},s.webviewData=null,s.webviewStart=null,s.webviewStartTime=null,s.finalSampling={},s.sampleData=null,s.sampleList=[f.LOAD,f.API,f.CUSTOM,f.ERROR,f.EVENT,f.RES],s.defaultSampleList={load:1,api:1,resource:.1,error:1,event:1,custom:1,isHit:!0},s.ignoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],s.lastRadarLogId="",s.computedSamplingAgain=!0,s.realSampledList=[],s.hasFmp=!1,s.customPerfList={},s.mainApiList=[],s.mainApiResult=[],s.observeResource=function(e){e.getEntriesByType("resource").forEach((function(e){return s.reportPerformance(e)}))},s.asyncReportTiming=function(){F("radarCreatedToOnload"),F("onloadToFirstReport"),setTimeout((function(){F("asyncReportTiming"),s.reportPerformance(v()),s.startedLoadReport=!0;try{s.observeResource(performance),s.observeChromeMetrics(s.chromeMetric),new PerformanceObserver(s.observeResource).observe({entryTypes:["resource"]})}catch(e){}F("radarCreatedToFirstReport"),F("onloadToFirstReport"),F("asyncReportTiming")}),0)},s.chromeMetricCallback=function(e){var t,n,r=e.name,o=e.value;r=r.toLocaleLowerCase();var a={key:f.CUSTOM,value:(t={},t[r]=o,t)};s.logCollect(a),s.logCollectNext({key:f.EVENT,dimension:{name:r},value:{duration:o}}),F(r+"Collect"),function(e){Object.assign(q,e)}(((n={})[r]=o,n))},s.observeChromeMetrics=function(e){var t=s.options;e.forEach((function(e){var n=e.name;t&&!t[n]||(F(n+"Collect"),e.collectFn(s.chromeMetricCallback))}))},s.asyncMetricCollectDone=function(){var e={};Object.keys(B).forEach((function(t){var n=B[t];!n.duration&&n.startTime&&(n.duration=0,delete n.startTime),e[t]=n.duration}));var t={key:f.CUSTOM,value:e};s.logCollect(t),s.flush(),s.weblog.flush(),l(window,s.eventName,s.asyncMetricCollectDone)},s.flush=function(){if(s.beforeFlush(),s.options&&!(s.logQueue.length<=0)&&s.startedLoadReport){var e=JSON.stringify(n(n({},s.weblog.commonPackage.getH5ExtraAttr()),{url:location.href,hash:location.hash,webviewStart:s.webviewStart,webviewStartTime:s.webviewStartTime,sampling_list:s.finalSampling?JSON.stringify(s.finalSampling):""})),t={project_id:s.options.projectId,radar_session_id:s.radarSessionId,h5_extra_attr:e},r=s.weblog.commonPackage,o=r.service_name,a=r.sub_biz,c=r.need_encrypt,u=r.app_package,l=s.currentUrlPackage&&s.currentUrlPackage.toJSON(),d=null;s.options.httpReportFirst||(d=s.addRadarStatEvent({key:y,value:n(n({},t),{data:i(s.logQueue),url_package:l,app_version_name:u.version_name}),serviceName:o||"",subBiz:a||"",needEncrypt:c||!1,container:u.container,realtime:!1,h5ExtraAttr:e})),d&&!s.options.httpReportFirst||s.weblog.collect("RADAR",{name:y,params:n(n({},t),{data:i(s.logQueue)}),currentUrlPackage:l,referUrlPackage:s.referUrlPackage&&s.referUrlPackage.toJSON(),serviceName:o||"radar_service_name"}),s.logQueue=[]}},s.flushNext=function(){if(s.options&&!(s.logQueueNext.length<=0)){var e=null;s.options.httpReportFirst||(e=s.reportByBridge()),e&&!s.options.httpReportFirst||s.reportByHttp(),s.logQueueNext=[]}},s.getCommonData=function(){var e,t,r,o=s.weblog.commonPackage.app_package,a=JSON.stringify(n(n({},s.weblog.commonPackage.getH5ExtraAttr()),{app_version_name:o.version_name,url:location.href,hash:location.hash,online:null===navigator||void 0===navigator?void 0:navigator.onLine,downlink:null===(e=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===e?void 0:e.downlink,rtt:null===(t=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===t?void 0:t.rtt})),i=s.currentUrlPackage&&s.currentUrlPackage.toJSON(),c=null===(r=s.options)||void 0===r?void 0:r.projectId;return{h5_extra_attr:a,url_package:i,app_version_name:o.version_name,project_id:c}},r&&(o=r),t&&(t.logger?s.apply(t):o=t),F("radarCreatedToFirstReport"),F("radarCreatedToOnload"),s.options=o,s.queueConfig=n(n({},s.queueConfig),s.options?s.options.queue:{}),s.options&&"string"==typeof s.options.mainApi?(s.mainApiList.push(s.options.mainApi),s.mainApiResult.push({})):s.options&&Array.isArray(s.options.mainApi)&&(s.options.mainApi.length,s.mainApiList=s.options.mainApi.slice(0,3),s.mainApiList.forEach((function(){return s.mainApiResult.push({})}))),s.ignoreList=s.ignoreList.concat((void 0===(a=s.options&&s.options.ignoreList)&&(a=[]),a.concat(k).map((function(e){return e.replace(M,"")})))),s}return t(r,e),Object.defineProperty(r.prototype,"KSwitchSampled",{get:function(){return this.weblog.currentUrlPackage.sampled},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isKSwitchSampled",{get:function(){return this.weblog.isKSwitchSampled},enumerable:!1,configurable:!0}),r.prototype.samplingControl=function(e){if(!e)return!1;var t=Math.random();return"number"==typeof e?t<e:t<e.sampling},r.prototype.use=function(e,t){var n=new e(t,this.options);this.plugins.push(n),this.weblog&&n.created()},r.prototype.apply=function(e){var t,n;this.weblog=e,this.kpn=this.weblog.Utils.ua.getDefaultKpn(),this.isInKwai=ie.indexOf(this.kpn)>=0,this.upadteUrlPackage(),this.register(),this.ignoreList.push(null===(n=null===(t=this.weblog)||void 0===t?void 0:t.logger)||void 0===n?void 0:n.url),this.created()},r.prototype.created=function(){this.plugins.forEach((function(e){e.created()}))},r.prototype.destroy=function(){l(window,"load",this.asyncReportTiming),this.plugins.forEach((function(e){e.destroy()}))},r.prototype.computedRealSampled=function(e,t){if(this.isKSwitchSampled){var n=void 0;if("object"==typeof this.KSwitchSampled&&this.KSwitchSampled.radar){var r=this.KSwitchSampled.radar.all;r="number"!=typeof r?1:r;var o=this.KSwitchSampled.radar[t];n="number"!=typeof o?r:o*r}else n=this.KSwitchSampled?1:0;return n*e}return 1},r.prototype.getWebviewData=function(){if(window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.pageLoadData){var e=null;try{var t=window.__yodaCommonDataObject__.pageLoadData;e="string"==typeof t?JSON.parse(t):t}catch(e){return}var r=e.created,o=e.pageStart,a=e.userStart;this.webviewData=n({webviewStart:a||o||r},e);var i={key:f.EVENT,value:null,dimension:{name:"客户端数据注入成功",event_type:"radar_inject_success"}};this.logCollect(i),this.logCollectNext(i)}},r.prototype.getSampleData=function(){var e=this,t=this.weblog.Utils.yoda;if(t?(this.sampleData=this.defaultSampleList,window.updateYodaSampleRateWithParams=function(t){e.updateSampleData(t),e.handleSample()}):this.handleSample(),window.__yodaCommonDataObject__&&window.__yodaCommonDataObject__.sampleData){this.updateSampleData(),this.handleSample();var n={key:f.EVENT,value:null,dimension:{name:"客户端采样率注入成功",event_type:"radar_sample_inject_success"}};this.logCollect(n),this.logCollectNext(n)}else t&&t.getWebviewLoadPerf().then((function(t){t.sampleData&&(e.updateSampleData(t.sampleData),e.handleSample())}))},r.prototype.updateSampleData=function(e){var t=this,n=null;try{var r=e||window.__yodaCommonDataObject__.sampleData;n="string"==typeof r?JSON.parse(r):r}catch(e){return}this.sampleData=this.defaultSampleList,n&&Object.keys(n).forEach((function(e){t.sampleData[e]=n[e]}))},r.prototype.register=function(){return o(this,void 0,void 0,(function(){var e,t,n;return a(this,(function(r){switch(r.label){case 0:return v()?("undefined"!=typeof window&&window.yodaCollectErrorDataDestroy&&window.yodaCollectErrorDataDestroy(),performance.timing.loadEventStart>0?this.asyncReportTiming():u(window,"load",this.asyncReportTiming),this.options&&this.options.radarCost&&u(window,this.eventName,this.asyncMetricCollectDone),u(window,this.eventName,this.flush),u(window,this.eventName,this.flushNext),this.getSampleData(),this.getWebviewData(),this.radarSessionId=this.nanoId(),this.radarSessionIdNext=this.uuid(),(e=this.weblog.Utils.yoda)?[3,1]:(this.isUsingBridge=!1,this.isSupportedYodaConcat=!1,this.isUsingLegacy=!1,[3,6])):[2];case 1:return null!=this.isUsingBridge?[3,3]:(t=this,[4,e.isSupportBridgeLog()]);case 2:t.isUsingBridge=r.sent(),r.label=3;case 3:return null!=this.isSupportedYodaConcat?[3,5]:(n=this,[4,e.isSupportBridge("sendRadarLog")]);case 4:n.isSupportedYodaConcat=r.sent(),r.label=5;case 5:this.isUsingLegacy=this.isUsingBridge&&!this.isSupportedYodaConcat,r.label=6;case 6:return this.isUsingDetachedReport=this.isInKwai&&!this.isUsingBridge||this.isUsingLegacy,[2]}}))}))},r.prototype.throttle=function(e,t,n,r){if(void 0===r&&(r={}),t.noThrottle||"number"!=typeof e)return e;var o=r.startPoint,a=r.endPoint;if(e>6e4||e<0||isNaN(e)){if(Math.random()<.1){var i="["+n+" 异常]: "+e+"，原始数据为："+t.end+": "+a+" - "+t.start+": "+o,s={key:f.EVENT,value:null,dimension:{name:"雷达数据异常",event_type:"radar_error",message:i,src:location.href,webViewType:Y(),yoda_version:J().yoda_version||""}};this.logCollect(s),this.logCollectNext(s)}return null}return Math.round(e)},r.prototype.reportPerformance=function(e){this.plugins.forEach((function(t){e&&t.when(e)&&t.onPerfReport(e)}))},r.prototype.calculate=function(e,t,n){var r=t[e];if(r){if(r.cachedSkip&&this.calculate("cached",t,n))return;if("function"==typeof r.custom){var o=r.custom(e,n);return this.throttle(o,r,e)}var a=r.end,i=r.start,s=+n[a]||performance.timing[a],u=+n[i]||performance.timing[i],l=s-u;if(!r.notCatchIfUndefined||void 0!==s&&void 0!==u)return this.throttle(l,r,e,{startPoint:u,endPoint:s})}else c("[warn 310]","[Radar] perf key "+e+" is unexpected!")},r.prototype.calculateNext=function(e,t,n){var r=t[e];if(r){if(r.cachedSkip&&this.calculateNext("cached",t,n))return;if("function"==typeof r.custom)return V(r.custom(e,n));var o=r.end,a=r.start,i=+n[o]||performance.timing[o],s=+n[a]||performance.timing[a],c=i-s;if(!r.notCatchIfUndefined||void 0!==i&&void 0!==s)return V(c)}},r.prototype.generateLog=function(e,t,n){var r=this;void 0===n&&(n=!0);var o={};return Object.keys(e).forEach((function(a){var i=a,s=n?r.calculate(i,e,t):r.calculateNext(i,e,t);null!=s&&(o[i]=s)})),o},r.prototype.subDimension=function(e){this.customDimension&&(e.dimension||(e.dimension={}),Object.assign(e.dimension,this.customDimension))},r.prototype.nanoId=function(){for(var e=1e9*Math.random()>>>0,t=[],n=0;n<7;n++)t.push("0123456789ABCDEF".charAt(16*Math.random()));return e+t.join("")},r.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},r.prototype.beforeFlush=function(){var e=this;if(this.computedSamplingAgain){var t={radarLoadSampling:{sampling:1,type:"load"},radarApiSampling:{sampling:this.options&&this.options.apiSampling||1,type:"api"},radarErrorSampling:{sampling:this.options&&this.options.errorSampling||1,type:"error"},radarResourceSampling:{sampling:this.options&&this.options.resourceSampling||.1,type:"resource"},radarCustomSampling:{sampling:this.options&&this.options.customSampling||1,type:"custom"},radarEventSampling:{sampling:this.options&&this.options.eventSampling||1,type:"event"}};this.realSampledList=[],Object.keys(t).forEach((function(n){var r=e.isKSwitchSampled?e.computedRealSampled(t[n].sampling,t[n].type):t[n],o=e.samplingControl(r);e.finalSampling[t[n].type]=r,o&&e.realSampledList.push(t[n].type)})),this.isKSwitchSampled&&(this.computedSamplingAgain=!1)}this.logQueue=this.logQueue.filter((function(t){return-1!==e.realSampledList.indexOf(t.key)}))},r.prototype.upadteUrlPackage=function(){this.weblog&&(this.computedSamplingAgain=!0,this.currentUrlPackage=this.weblog.currentUrlPackage,this.referUrlPackage=this.weblog.referUrlPackage)},r.prototype.decorateLog=function(e){this.currentUrlPackage||this.upadteUrlPackage(),this.customDimension&&this.subDimension(e),this.currentUrlPackage&&this.currentUrlPackage.page!==this.weblog.currentUrlPackage.page&&(this.flushNext(),this.flush(),this.upadteUrlPackage())},r.prototype.logCollect=function(e){var t=this;if(this.options&&!this.options.unuseOldRadar){this.decorateLog(e);try{window.dispatchEvent(new CustomEvent("get-radar-data",{detail:{kv:e}}))}catch(e){}var n=!0;if("load"===e.key)for(var r=0;r<this.logQueue.length;r++){var o=this.logQueue[r];if("load"===o.key){Object.assign(o,e),n=!1;break}}n&&this.logQueue.push(e),z("radarLog",JSON.parse(JSON.stringify(e))),this.batchTimer||(this.logQueue.length>this.queueConfig.maxBatchLength?this.flush():this.batchTimer=window.setTimeout((function(){t.flush(),clearTimeout(t.batchTimer),t.batchTimer=0}),this.queueConfig.wait))}},r.prototype.addRadarStatEvent=function(e){var t=this;try{var r=this.weblog.Utils.yoda;if(!r)return!1;var o=function(e){var t,r;if(!e.value)return e;var o=e.value,a=function(e){var t,n=[];return e.forEach((function(e){"load"===e.key?t=e:n.push(e)})),[t,n]}(o.data),i=a[0],s=a[1],c={project_id:o.project_id,app_version_name:o.app_version_name,url_package:o.url_package,h5_extra_attr:e.h5ExtraAttr};return{loadLog:i?{removeStashedLog:[],sendImmediate:null!==(r=null===(t=i.dimension)||void 0===t?void 0:t.sendImmediate)&&void 0!==r&&r,customData:n({data:[i]},c)}:null,commonLog:s.length?{removeStashedLog:[],sendImmediate:!0,customData:n({data:s},c)}:null}}(e),a=o.loadLog,i=o.commonLog;if(a){if(this.lastRadarLogId&&(a.removeStashedLog=[this.lastRadarLogId],a.sendImmediate)){var s={removeStashedLog:[this.lastRadarLogId],sendImmediate:!1,customData:{"":""}};r.sendRadarLog(s).then((function(e){e&&e.logId&&(t.lastRadarLogId=e.logId)}))}r.sendRadarLog(a).then((function(e){e&&e.logId&&(t.lastRadarLogId=e.logId)}))}return i&&r.sendRadarLog(i),!0}catch(e){return!1}},r.prototype.calculateSample=function(e){var t=(null==e?void 0:e.load)||1,n={};return e&&Object.keys(e).forEach((function(r){var o=e[r]/t;n[r]=o>1?1:o})),n},r.prototype.handleSample=function(){var e,t,n,r,o,a,i,s,c=this;this.weblog.Utils.yoda||this.sampleData||(this.sampleData={load:(null===(e=this.options)||void 0===e?void 0:e.sampling)||1,api:(null===(t=this.options)||void 0===t?void 0:t.apiSampling)||1,resource:(null===(n=this.options)||void 0===n?void 0:n.resourceSampling)||.1,error:(null===(r=this.options)||void 0===r?void 0:r.errorSampling)||1,event:(null===(o=this.options)||void 0===o?void 0:o.eventSampling)||1,custom:(null===(a=this.options)||void 0===a?void 0:a.customSampling)||1}),s=this.calculateSample(this.sampleData),i={radarLoadSampling:{sampling:1,type:"load"},radarApiSampling:{sampling:(null==s?void 0:s.api)||1,type:"api"},radarErrorSampling:{sampling:(null==s?void 0:s.error)||1,type:"error"},radarResourceSampling:{sampling:(null==s?void 0:s.resource)||.1,type:"resource"},radarCustomSampling:{sampling:(null==s?void 0:s.custom)||1,type:"custom"},radarEventSampling:{sampling:(null==s?void 0:s.event)||1,type:"event"}},this.sampleList=[],Object.keys(i).forEach((function(e){var t=i[e];c.samplingControl(t)&&c.sampleList.push(i[e].type)}))},r.prototype.logCollectNext=function(e){var t=this,r=X(e);if(this.options&&(!this.sampleData||!1!==this.sampleData.isHit)&&this.sampleList.some((function(e){return e===r.key}))){this.decorateLog(r);var o=this.getCommonData(),a=o.app_version_name;delete o.app_version_name;var i=new ae((function(e,r){return e.dimension.app_version_name=a,n(n(n({},e),o),{event_client_timestamp:Date.now(),event_trigger_source:"H5",radar_session_id:t.radarSessionIdNext})}));if(i.use((function(e,t){return e.key&&"load"===e.key&&(e.dimension=n(n({},e.dimension),{load_device_increase_id:$("LOAD_DEVICE_INCREASE_ID"),load_session_increase_id:ee("LOAD_SESSION_INCREASE_ID")})),e.key&&"load"!==e.key&&(e.dimension=n(n({},e.dimension),{other_device_increase_id:$("OTHER_DEVICE_INCREASE_ID"),other_session_increase_id:ee("OTHER_SESSION_INCREASE_ID")})),t()}),(function(e,n){return e.dimension.sample_rate=t.sampleData&&t.sampleData[e.key]||1,n()})),(r=i.invoke(r))instanceof Error)throw r;try{window.dispatchEvent(new CustomEvent("get-radar-next-data",{detail:{kv:X(r)}}))}catch(e){}delete r.dimension.broadcast_info;var s=!0;if("load"===r.key)for(var c=0;c<this.logQueueNext.length;c++){var u=this.logQueueNext[c];if("load"===u.key){Object.assign(u,r),s=!1;break}}s&&this.logQueueNext.push(r),z("radarLogNext",JSON.parse(JSON.stringify(r))),this.batchTimerNext||(this.logQueueNext.length>this.queueConfig.maxBatchLength?this.flushNext():this.batchTimerNext=window.setTimeout((function(){t.flushNext(),clearTimeout(t.batchTimerNext),t.batchTimerNext=0}),this.queueConfig.wait))}},r.prototype.reportByHttp=function(){var e,t=this.getCommonData(),n={project_id:null===(e=this.options)||void 0===e?void 0:e.projectId,radar_session_id:this.radarSessionIdNext,h5_extra_attr:t.h5_extra_attr},r=this.logQueueNext.filter((function(e){return"load"===e.key})),o=this.logQueueNext.filter((function(e){return"load"!==e.key}));Array.isArray(r)&&r.length&&this.collectLog(n,r,"radarSDK"),Array.isArray(o)&&o.length&&this.collectLog(n,o,"radarSDKSupplement")},r.prototype.collectLog=function(e,t,r){(this.weblog.sendByHttp||this.weblog.collect).call(this.weblog,"RADAR",{name:y,params:n(n({},e),{data:i(t)}),serviceName:r})},r.prototype.reportByBridge=function(){var e=this.weblog.Utils.yoda;if(!e)return!1;var t=this.logQueueNext.filter((function(e){return"load"===e.key})),n=this.logQueueNext.filter((function(e){return"load"!==e.key}));if(!t.length&&!n.length)return!0;try{if(t.length){var r=t[0];e.sendSummarizedLog({key:"h5_load",data:r})}return n.length&&e.sendRadarLog({data:n}),!0}catch(e){return!1}},r}(g),ce=function(e,t){this.radar=e,this.options=t},ue=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="navigation",t.logData={},t.logSended=!1,t.saveWebviewEntry={},t.hasReportBase=!1,t.record={fmp:!1,base:!1,webviewPerf:!1},t.loadTimeout=null,t.gettingWebview=!1,t.REPEAT_TIME=5,t.getWebviewTimes=t.REPEAT_TIME,t.reportOnUnload=function(e){t.logSended||t.radar.isSupportedYodaConcat||(t.logSended=!0,t.reportFirstScreen(Object.assign(t.logData,q)),t.radar.logCollect(t.data),"noflush"!==e&&(t.radar.flush(),t.radar.weblog.flush()))},t}return t(n,e),Object.defineProperty(n.prototype,"sendImmediate",{get:function(){return this.record.fmp&&this.record.base&&this.record.webviewPerf&&!(!(e=window.navigator.userAgent.match(/tbht\/([\w]+)/i))||"0"===e[1]);var e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"data",{get:function(){return this.sepDimension({key:f.LOAD,value:this.logData})},enumerable:!1,configurable:!0}),n.prototype.created=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return[2]}))}))},n.prototype.when=function(e){if(e.custom){var t=(e.entry||{}).key;return["fmp","play_clicked","play_idr","webViewPerf"].indexOf(t)>-1}return!e.entryType||"navigation"===e.entryType},n.prototype.getWebviewLoadData=function(){return o(this,void 0,void 0,(function(){var e,t,n,r,o,i,s;return a(this,(function(a){switch(a.label){case 0:return this.record.webviewPerf?[2,!0]:(e=this.radar.weblog.Utils.yoda,(n=e)?[4,e.getWebviewLoadPerf()]:[3,2]);case 1:n=a.sent(),a.label=2;case 2:return(t=n)&&t.timeData?(this.record.webviewPerf=!0,r=t.timeData,o=r.userStart,i=r.pageStart,s=r.created,this.radar.webviewStart="userStart",this.radar.webviewStartTime=o,o||(i?(t.timeData.userStart=i,this.radar.webviewStart="pageStart",this.radar.webviewStartTime=i):(t.timeData.userStart=s,this.radar.webviewStart="created",this.radar.webviewStartTime=s)),this.onPerfReport({custom:!0,entry:{key:"webViewPerf",value:t.timeData}}),[2,!0]):[2,!1]}}))}))},n.prototype.webviewPatch=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return this.gettingWebview?[2]:(this.gettingWebview=!0,[4,this.repeatWebview()]);case 1:return e.sent(),this.gettingWebview=!1,[2]}}))}))},n.prototype.repeatWebview=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.getWebviewLoadData()];case 1:return!e.sent()&&this.getWebviewTimes>0?(this.getWebviewTimes--,[4,this.repeatWebview()]):[3,3];case 2:e.sent(),e.label=3;case 3:return this.getWebviewTimes=this.REPEAT_TIME,[2]}}))}))},n.prototype.onPerfReport=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o,i,s,c,u,l,d=this;return a(this,(function(a){if(e.custom){if((t=e.entry)&&(n=t.key,r=t.value,o=e.renderTime,"fmp"===n&&(performance.timing.radarFmp=o,this.record.fmp=!0,u=G(performance.timing,O),Object.assign(this.logData,((l={})[n]=r,l),u),this.webviewPatch(),this.record.webviewPerf&&(s=this.radar.generateLog(P,this.saveWebviewEntry),Object.assign(this.logData,s))),"webViewPerf"===n)){if(!(i=t.value))return[2];this.saveWebviewEntry=i,s=this.radar.generateLog(P,i),Object.assign(this.logData,s)}}else c=this.radar.generateLog(w,e),u=G(performance.timing,O),Object.assign(this.logData,c,u),this.record.base=!0;return this.radar.isSupportedYodaConcat?(this.webviewPatch(),this.radar.logCollect(this.data)):this.radar.isUsingDetachedReport&&this.record.webviewPerf&&this.record.fmp&&this.record.base?this.reportOnUnload("noflush"):this.record.fmp&&this.record.base&&!this.hasReportBase?(clearTimeout(this.loadTimeout),this.loadTimeout=null,this.loadReport()):!this.hasReportBase&&this.record.base&&(this.loadTimeout=setTimeout((function(){d.loadReport(),d.hasReportBase=!0}),2e3)),[2]}))}))},n.prototype.destroy=function(){clearTimeout(this.delay)},n.prototype.sepDimension=function(e){var t=e.key,n=e.value,o=n.protocol;return{key:t,value:r(n,["protocol"]),dimension:{protocol:o,sendImmediate:this.sendImmediate}}},n.prototype.reportFirstScreen=function(e){if(e.play_clicked&&e.play_idr){var t=e.play_idr-e.play_clicked;t>0&&t<6e4&&(this.logData.play_first_screen=t)}},n.prototype.loadReport=function(){Object.assign(this.logData,q),this.radar.logCollect(X(this.data)),this.radar.flush(),this.radar.weblog.flush()},n}(ce);!function(e){e.LOAD="load",e.RES="resource",e.API="api",e.ERROR="error",e.SDK_ERROR="sdk_error",e.CUSTOM="custom",e.BATCH="batch",e.EVENT="event"}(re||(re={})),function(e){e.SCRIPT="script",e.RES="res",e.API="api",e.VIDEO="video"}(oe||(oe={}));var le={redirect:{end:"redirectEnd",start:"redirectStart"},dns:{end:"domainLookupEnd",start:"domainLookupStart"},dns_start:{end:"domainLookupEnd",start:"navigationStart"},tcp:{end:"connectEnd",start:"connectStart"},tcp_start:{end:"connectEnd",start:"navigationStart"},redirect_count:{custom:function(e,t){return t.redirectCount}},ssl:{custom:function(e,t){var n=t;return t.secureConnectionStart||t.requestStart||(n=performance.timing),0===n.secureConnectionStart?0:n.requestStart-n.secureConnectionStart}},ssl_start:{custom:function(e,t){var n=t;return t.secureConnectionStart||t.requestStart||(n=performance.timing),0===n.secureConnectionStart?0:n.secureConnectionStart-n.redirectStart}},ttfb:{end:"responseStart",start:"requestStart"},request_start:{end:"requestStart",start:"navigationStart"},trans:{end:"responseEnd",start:"responseStart"},dom_parse:{end:"domInteractive",start:"responseEnd"},dom_parse_start:{end:"domInteractive",start:"navigationStart"},blank:{end:"domLoading",start:"navigationStart"},fb:{end:"responseStart",start:"navigationStart"},dom_ready:{end:"domContentLoadedEventEnd",start:"navigationStart"},total:{end:"loadEventStart",start:"navigationStart"},resource:{end:"loadEventStart",start:"domInteractive"},fp:{custom:function(){if("function"!=typeof performance.getEntries)return null;var e=performance.getEntries().filter((function(e){return"first-paint"===e.name}))[0];return e?Math.ceil(e.startTime+e.duration):null}},js_cost:{custom:function(){if("function"!=typeof performance.getEntries)return null;var e=v(),t=performance.getEntries(),n=performance.getEntries().filter((function(e){return"navigation"===e.initiatorType}))[0],r=t.filter((function(e){return"script"===e.initiatorType}))[0],o=n?n.domComplete:e.domComplete-e.navigationStart;return r&&o?o-r.fetchStart:null}},tti:{end:"domInteractive",start:"navigationStart"},protocol:{custom:function(e,t){return t.nextHopProtocol}},dom_num:{custom:function(){return"undefined"!=typeof document?document.all.length:null}}},de={fetch_start:{custom:function(e,t){return Math.round(t.fetchStart)},noThrottle:!0},dns:{end:"domainLookupEnd",start:"domainLookupStart",cachedSkip:!0},tcp:{end:"connectEnd",start:"connectStart",cachedSkip:!0},ssl:{cachedSkip:!0,custom:function(e,t){return 0===t.secureConnectionStart?0:t.requestStart-t.secureConnectionStart}},ttfb:{end:"responseStart",start:"requestStart",cachedSkip:!0},trans:{end:"responseEnd",start:"responseStart",cachedSkip:!0},fb:{end:"responseStart",start:"fetchStart",cachedSkip:!0},total:{end:"responseEnd",start:"fetchStart"},duration:{end:"responseEnd",start:"fetchStart"},size:{cachedSkip:!0,custom:function(e,t){return t.encodedBodySize},noThrottle:!0},protocol:{custom:function(e,t){return t.nextHopProtocol}},file:{custom:function(e,t){return t.name},noThrottle:!0},res_type:{custom:function(e,t){return t.initiatorType}},cached:{custom:function(e,t){return 0===t.transferSize||null==t.transferSize&&0===t.domainLookupStart},noThrottle:!0}},pe={main_api:{end:"apiEnd",start:"apiStart"},main_api_offset:{end:"apiStart",start:"domLoading"}},fe={navigation_start_time:"navigationStart",fetch_start_time:"fetchStart",dns_start_time:"domainLookupStart",dns_end_time:"domainLookupEnd",connect_start_time:"connectStart",ssl_start_time:"secureConnectionStart",request_start_time:"requestStart",response_start_time:"responseStart",response_end_time:"responseEnd",dom_interactive_time:"domInteractive",dom_loading_time:"domLoading",dom_ready_time:"domContentLoadedEventEnd",load_event_time:"loadEventStart",fmp_time:"radarFmp",connect_end_time:"connectEnd",load_event_end:"loadEventEnd",dom_complete:"domComplete",dom_content_loaded_event_start:"domContentLoadedEventStart",redirect_start:"redirectStart",redirect_end:"redirectEnd"},me={navigation_start:"startTime",redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"},he={redirect_start:"redirectStart",redirect_end:"redirectEnd",dns_start:"domainLookupStart",dns_end:"domainLookupEnd",connect_start:"connectStart",connect_end:"connectEnd",ssl_start:"secureConnectionStart",request_start:"requestStart",response_start:"responseStart",response_end:"responseEnd"},ge=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="navigation-radar-plus",t.logData={},t.isMainApi=!1,t.hasReportMainApi=!1,t}return t(n,e),Object.defineProperty(n.prototype,"data",{get:function(){return this.sepDimension({key:re.LOAD,value:this.logData})},enumerable:!1,configurable:!0}),n.prototype.created=function(){return o(this,void 0,void 0,(function(){return a(this,(function(e){return this.onPerfReport({custom:!0,entry:{key:"radar_init",value:null}}),[2]}))}))},n.prototype.when=function(e){if(e.custom){var t=(e.entry||{}).key;return["fmp","customPerf"].indexOf(t)>-1}return this.isMainApi=this.radar.mainApiResult.some((function(t){return t.url&&e.name===t.url})),!(!this.isMainApi||"fetch"!==e.initiatorType&&"xmlhttprequest"!==e.initiatorType||!this.radar.mainApiResult.filter((function(e){return e.url})).every((function(e){return e.catch}))||this.hasReportMainApi||(this.hasReportMainApi=!0,!this.radar.hasFmp))||!e.entryType||"navigation"===e.entryType},n.prototype.onPerfReport=function(e){return o(this,void 0,void 0,(function(){var t,n,r,o,i,s,c,u=this;return a(this,(function(a){if(e.custom){if((t=e.entry)&&(n=t.key,r=t.value,o=e.renderTime,"radar_init"===n&&Object.assign(this.logData,{event_name:"radar_init"}),"fmp"===n&&(performance.timing.radarFmp=o,i=this.radar.generateLog(pe,performance.timing,!1),Object.assign(this.logData,((c={})[n]=r,c),{event_name:"fmp"},i)),"customPerf"===n&&(s={},Object.keys(this.radar.customPerfList).forEach((function(e){s[e+"_time"]=u.radar.customPerfList[e].time})),Object.assign(this.logData,{event_name:"h5_custom_metric",custom_metric:JSON.stringify(s),custom_metric_name:r,custom_metric_timestamp:this.radar.customPerfList[r].time}),this.radar.customPerfList[r]&&this.radar.customPerfList[r].options&&!0!==this.radar.customPerfList[r].options.sendTimeline)))return[2]}else this.isMainApi?Object.assign(this.logData,{event_name:"main_api"}):Object.assign(this.logData,{event_name:"h5_load"});return this.getCommonLog(e),this.loadReport(),[2]}))}))},n.prototype.destroy=function(){},n.prototype.getCommonLog=function(e){var t=this.radar.generateLog(le,e,!1),n=G(performance.timing,fe);Object.assign(this.logData,t,n,{main_api_list:this.radar.mainApiResult})},n.prototype.sepDimension=function(e){var t=e.key,n=e.value,o=n.protocol,a=n.event_name,i=n.custom_metric,s=n.custom_metric_name,c=n.main_api_list;return{key:t,value:r(n,["protocol","event_name","custom_metric","custom_metric_name","main_api_list"]),dimension:{protocol:o,event_name:a,custom_metric:i,custom_metric_name:s,main_api_list:c}}},n.prototype.loadReport=function(){Object.assign(this.logData,q),this.collectAndFlush()},n.prototype.collectAndFlush=function(){this.radar.logCollectNext(X(this.data)),this.radar.flushNext(),this.radar.weblog.flush()},n}(ce),ve=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="resource",t.onResError=function(e){t.isScriptError(e)||t.radar.logCollect(t.sepDimension({key:f.RES,value:{failed:!0,file:e.target.src,res_path:Q(e.path||e.composedPath&&e.composedPath())}}))},t}return t(n,e),n.prototype.created=function(){u(window,"error",this.onResError,!0)},n.prototype.when=function(e){return!W(e.name,this.radar.ignoreList)&&"resource"===e.entryType&&"fetch"!==e.initiatorType&&"xmlhttprequest"!==e.initiatorType},n.prototype.isScriptError=function(e){return e.message||null!=e.lineno},n.prototype.onPerfReport=function(e){var t=this.radar.generateLog(E,e);this.radar.logCollect(this.sepDimension({key:f.RES,value:t}))},n.prototype.destroy=function(){l(window,"error",this.onResError,!0)},n.prototype.sepDimension=function(e){var t=e.key,n=e.value,o=n.protocol,a=n.file,i=n.cached,s=n.res_path,c=n.failed,u=n.res_type;return{key:t,value:r(n,["protocol","file","cached","res_path","failed","res_type"]),dimension:{protocol:o,file:a,cached:i,failed:c,res_path:s,res_type:u}}},n}(ce),ye=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="resource",t.onResError=function(e){t.isScriptError(e)||t.radar.logCollectNext(t.sepDimension({key:re.RES,value:{failed:!0,file:e.target.src||e.target.href,res_path:Q(e.path||e.composedPath&&e.composedPath())}}))},t}return t(o,e),o.prototype.created=function(){u(window,"error",this.onResError,!0)},o.prototype.when=function(e){return!W(e.name,this.radar.ignoreList)&&("resource"===e.entryType&&"fetch"!==e.initiatorType&&"xmlhttprequest"!==e.initiatorType||"resource"===e.entryType&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)&&("js"===K(e.name)||"css"===K(e.name)))},o.prototype.isScriptError=function(e){return e.message||null!=e.lineno},o.prototype.onPerfReport=function(e){var t=this.radar.generateLog(de,e,!1),r={encoded_body_size:e.encodedBodySize+"",decoded_body_size:e.decodedBodySize+""};Object.keys(he).forEach((function(t){r[t]=Number(e[he[t]]+performance.timing.navigationStart).toFixed()})),this.radar.logCollectNext(this.sepDimension({key:re.RES,value:n(n(n({},t),r),{failed:!1})}))},o.prototype.destroy=function(){l(window,"error",this.onResError,!0)},o.prototype.sepDimension=function(e){var t=e.key,n=e.value,o=n.protocol,a=n.file,i=n.cached,s=n.res_path,c=n.failed,u=n.res_type;return{key:t,value:r(n,["protocol","file","cached","res_path","failed","res_type"]),dimension:{protocol:o,file:a,cached:i,failed:c,res_path:s,res_type:u}}},o}(ce);function _e(e){return void 0===e&&(e=""),"__radar_"+e+Math.random().toString(36).substring(2,8)}function Se(e,t){var r=window.XMLHttpRequest;return r?(window.XMLHttpRequest=function(){var o=new r;o._radarRequest=Object.create(null),o._radarResponse=Object.create(null);var a=_e();o._radarRequest.id=a;var i=function(){var e,t,n,r;for(e in o._radarResponse.status=o.status,o._radarResponse.statusText=o.statusText,r=function(e,t){switch(null==t&&(t={}),typeof e){case"object":var n=[];for(var r in e){var o=e[r],a=r.toLowerCase();n.push(a+":\t"+o)}return n.join("\n")+"\n";case"string":for(var i=0,s=(n=e.split("\n")).length;i<s;i++){var c=n[i];if(/([^:]+):\s*(.+)/.test(c)){var u=RegExp.$1,l=null!=u?u.toLowerCase():void 0;o=RegExp.$2,null==t[l]&&(t[l]=o)}}return t}}(o.getAllResponseHeaders()))n=r[e],o._radarResponse&&o._radarResponse.headers&&!o._radarResponse.headers[e]&&(t=e.toLowerCase(),o._radarResponse.headers[t]=n)};if(o.addEventListener("readystatechange",(function(){switch(o.readyState){case 4:"function"==typeof t&&(i(),function(){if(o.responseType&&"text"!==o.responseType)"document"===o.responseType?(o._radarResponse.xml=o.responseXML,o._radarResponse.data=o.responseXML):o._radarResponse.data=o.response;else{o._radarResponse.text=o.responseText,o._radarResponse.data=o.responseText;try{o._radarResponse.xml=o.responseXML}catch(e){}}"responseURL"in o&&(o._radarResponse.finalUrl=o.responseURL)}(),t(o._radarRequest,o._radarResponse))}})),"function"==typeof o.open){var s=o.open;o.open=function(e,t,r,o,a){var i=[].slice.call(arguments);return this._radarRequest=n({method:e,url:t,async:r,user:o,pass:a},this._radarRequest),this._radarResponse.headers={},s.apply(this,i)}}if("function"==typeof o.send){var c=o.send;o.send=function(){var t=[].slice.call(arguments);return"function"==typeof e&&(this._radarRequest._config=t[0],e(this._radarRequest)),c.apply(this,t)}}return o},["DONE","HEADERS_RECEIVED","LOADING","OPENED","UNSENT"].forEach((function(e){window.XMLHttpRequest[e]=r[e]})),window.XMLHttpRequest.prototype=r.prototype,function(){r&&(window.XMLHttpRequest=r)}):(c("HAS NOT XMLHttpRequest!"),!1)}function we(e,t){var n=function(e){if("function"!=typeof e.fetch)return null;var t=e.fetch;return e.fetch=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return ke.apply(void 0,i([e],t))}}(e.fetch),{register:function(e){return be.push(e),function(){var t=be.indexOf(e);t>=0&&be.splice(t,1)}},clear:function(){be=[]},unRegister:function(){t&&(e.fetch=t)}}}("function"==typeof importScripts?self:window);return n&&n.register({request:function(t,n){"function"==typeof e&&e(t)},response:function(e,n){"function"==typeof t&&t(n,e)},responseError:function(e,n){"function"==typeof t&&t(n,{status:0,statusText:e})}}),null==n?void 0:n.unRegister}var be=[],Ee=["application/json","text/html","text/plain"];function ke(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=be.reduce((function(e,t){return[t].concat(e)}),[]),o="string"==typeof t[0]?new Request(t[0],t[1]):t[0];o.id=_e(),r.forEach((function(e){var t=e.request;o=t(o)||o}));var a=o.clone(),i=e.apply(void 0,t),s=null,c=null,u=!1;return i.then((function(e){var t=e.headers.get("content-type");if(t&&Ee.some((function(e){return t.indexOf(e)>-1}))){u=!0;var n=e.clone();return s=n.clone(),n.clone().text()}return s=e,"[object Object]"})).then((function(e){c=e;try{return a.text()}catch(e){return"Radar: Request.text()失败"}})).then((function(e){o._config=e;var t=null;return u?(t=s.clone()).data=c:t=s,r.forEach((function(e){var n=e.response;n&&(t=n(t,o)||t)})),s}),(function(e){throw r.forEach((function(t){var n=t.responseError;n&&(e=n(e,o)||e)})),e}))}var Pe=function(e){function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.queue=[],t.key="api",t.logList=[],t.perfList=[],t.unhookXML=null,t.unhookFetch=null,t.beforeHook=function(e){if(!W(e.url,t.radar.ignoreList)&&"js"!==K(e.url)&&"css"!==K(e.url)){var n={api:t.requestURLCompletion(e.url),method:e.method,request:e,startTime:Date.now()};t.queue.push(n)}},t.afterHook=function(e,o){var a=t.queue.filter((function(t){return t.request===e}))[0];if(a){var i=ne(a.api,t.radar.mainApiList);i>-1&&!t.radar.hasFmp&&(t.radar.mainApiResult[i].url=a.api),delete a.request;var s=a.startTime,c=r(a,["startTime"]),u=Date.now(),l=u-s+"",d=o.status;"function"==typeof t.options.customizeRadarStatus&&(d=t.options.customizeRadarStatus(o));var p=t.customHook({request:e,response:o,duration:l}),m=Te(o.headers),h=n(n({duration:l,logTime:Date.now().toString(),total:l,status:d,size:+m+"",content_type:Oe(o.headers),custom_failed:!(d>=200&&d<300)},c),p);o.finalUrl&&(h.api=o.finalUrl),"string"==typeof o.text&&(h.responseData=o.text);var g=n(n({},o),{status:d});if(t.isResponseError(g))t.radar.logCollect(t.sepDimension({key:f.API,value:h})),t.radar.logCollectNext(t.sepDimension({key:f.API,value:h}));else{if(!t.radar.hasFmp){var v=performance.timing.apiStart;performance.timing.apiStart=v?Math.min(v,s):s;var y=performance.timing.apiEnd;performance.timing.apiEnd=y?Math.max(y,u):u}!t.mergeAPIPerf(null,h)&&t.logList.push(h)}t.queue=t.queue.filter((function(t){return t.request&&t.request!==e}))}},t}return t(o,e),o.prototype.when=function(e){return!W(e.name,this.radar.ignoreList)&&"resource"===e.entryType&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)&&"js"!==K(e.name)&&"css"!==K(e.name)},o.prototype.onPerfReport=function(e){var t=this.radar.generateLog(b,e,!1);t.perfTime=Date.now().toString();var r={encoded_body_size:e.encodedBodySize&&e.encodedBodySize+"",decoded_body_size:e.decodedBodySize&&e.decodedBodySize+""};Object.keys(me).forEach((function(t){r[t]=Number(e[me[t]]+performance.timing.navigationStart).toFixed()}));var o=n(n({},t),{api:t.file,apiTime:r});!this.mergeAPIPerf(o)&&this.perfList.push(o)},o.prototype.mergeAPIPerf=function(e,t){var r=e||t,o=e?this.logList:this.perfList;if(!r)return!1;for(var a=-1,i=0,s=o.length;i<s;i++){var c=o[i],u=(r.api||"").replace(/\?.+$/,""),l=(c.api||"").replace(/\?.+$/,""),d=r.size;if(u===l){Object.assign(r,c);var m=ne(u,this.radar.mainApiList);m>-1&&!0!==this.radar.mainApiResult[m].catch&&(this.radar.mainApiResult[m]=n(n({},r.apiTime),{url:r.api,status:r.status,size_radar:r.size,cached:r.cached,method:r.method,catch:!0,perfTime:r.perfTime})),Object.assign(r,r.apiTime),delete r.file,d&&(r.size=d),!r.size&&r.responseData&&(r.size=p(r.responseData)),delete r.responseData,a=i}}return-1!==a&&(o.splice(a,1),this.radar.logCollect(this.sepDimension({key:f.API,value:r})),this.radar.logCollectNext(this.sepDimension(X({key:f.API,value:r}))),!0)},o.prototype.sepDimension=function(e){var t=e.key,n=e.value,o=n.res_type,a=n.protocol,i=n.cached,s=n.custom_failed,c=n.content_type,u=n.broadcast_info,l=n.status,d=n.api,p=n.method,f=n.response_code,m=n.response_msg;return n.apiTime,{key:t,value:r(n,["res_type","protocol","cached","custom_failed","content_type","broadcast_info","status","api","method","response_code","response_msg","apiTime"]),dimension:{res_type:o,protocol:a,api:d,custom_failed:s,content_type:c,status:l,cached:i,method:p,response_code:f,response_msg:m,broadcast_info:u}}},o.prototype.requestURLCompletion=function(e){var t=document.location,n=t.protocol,r=t.host;return 0===e.indexOf("//")?n+e:0===e.indexOf("/")?n+"//"+r+e:e},o.prototype.isResponseError=function(e){return 0===e.status},o.prototype.created=function(){this.unhookXML=Se(this.beforeHook,this.afterHook),this.unhookFetch=we(this.beforeHook,this.afterHook)},o.prototype.destroy=function(){this.unhookXML&&this.unhookXML(),this.unhookFetch&&this.unhookFetch()},o.prototype.customHook=function(e){var t={};if("function"!=typeof this.options.APIHook)return t;var n={};try{n=this.options.APIHook(e)}catch(e){return{}}if(!n)return t;var r=n.response_msg,o=n.response_code,a=n.status,i=n.custom_failed,s=n.broadcast_info;try{t.response_msg=JSON.stringify(r).slice(0,100)}catch(e){t.response_msg="radar error: 传入的response_msg有错误"}return t.response_code=Number(o),void 0!==a&&(t.status=a),void 0!==i&&(t.custom_failed=i),t.broadcast_info=s,t},o}(ce);function Oe(e){return e?"function"==typeof e.get?e.get("Content-Type"):e["content-type"]:null}function Te(e){return e?"function"==typeof e.get?+e.get("Content-Length")||0:+e["content-length"]||0:0}var Ie=[];function xe(e,t){Le(t)>=0||(Ie.push(t),setTimeout((function(){Ie.splice(Le(t),1)}),2e3),Ce(e,t))}function Ce(e,t){var n=function(e){var t=f.ERROR,n=e.error_cons_type,o=e.file,a=e.error_type,i=e.msg,s=e.col,c=e.line,u=e.stack;return{key:t,value:r(e,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:n,file:o,error_type:a,msg:i,col:s,line:c,stack:u}}}(t);e.logCollect(n)}function Le(e){for(var t=0;t<Ie.length;t++)if(r=e,(n=Ie[t]).msg===r.msg&&n.stack===r.stack&&n.file===r.file&&n.line===r.line&&n.col===r.col)return t;var n,r;return-1}function Ne(e){return e.message||null!=e.lineno}function Re(e,t,n){var r,o,a,i;return(i=t)&&(i instanceof Error||"object"==typeof i&&"string"==typeof i.message)?(r=t.name||"ErrorLikeObject",o=t.message||"",a=t.stack||void 0):function(e,t){return null==e&&"Script error."===(null==t?void 0:t.message)}(t,n)?(r="CrossOriginError",o="* cross origin "+e+" with message: "+((null==n?void 0:n.message)||"<UNKNOWN>")+"\n -- by WebLogger Radar Plugin"):(r=null==t?""+t:typeof t,o="* "+e+" with value: "+function(e){var t;try{t=e.toString()}catch(e){}return"string"!=typeof t||""===t?t=null===e?"<NULL>":void 0===e?"<UNDEFINED>":""===t?"<EMPTY>":"<UNKNOWN>":t.length>2e3&&(t=t.substring(0,2e3)+"<<< ……"),t}(t)+"\n  -- by WebLogger Radar Plugin"),{error_type:h.SCRIPT,error_cons_type:r,msg:o,stack:a}}var Ae=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="error",t.onError=function(e){if(Ne(e)){var r=n(n({},Re("global error",e.error,e)),{file:e.filename,line:e.lineno,col:e.colno});xe(t.radar,r)}},t.onPromiseError=function(e){var n=Re("promise error",e.reason);xe(t.radar,n)},t}return t(r,e),r.prototype.when=function(e){if(e.custom){var t=(e.entry||{}).key;if(["play_block","play_error"].indexOf(t)>-1)return!0}return!1},r.prototype.onPerfReport=function(e){if(e.custom){var t=e.entry||{},n=t.key,r=t.value;Ce(this.radar,{error_type:h.VIDEO,error_cons_type:n,msg:r})}},r.prototype.created=function(){u(window,"error",this.onError,!0),u(window,"unhandledrejection",this.onPromiseError)},r.prototype.destroy=function(){l(window,"error",this.onError,!0),l(window,"unhandledrejection",this.onPromiseError)},r}(ce),De=[];function je(e,t){Me(t)>=0||(De.push(t),setTimeout((function(){De.splice(Me(t),1)}),2e3),Ue(e,t))}function Ue(e,t){var n=function(e){var t=re.ERROR,n=e.error_cons_type,o=e.file,a=e.error_type,i=e.msg,s=e.col,c=e.line,u=e.stack;return{key:t,value:r(e,["error_cons_type","file","error_type","msg","col","line","stack"]),dimension:{error_cons_type:n,file:o,error_type:a,msg:i,col:s,line:c,stack:u}}}(t);e.logCollectNext(n)}function Me(e){for(var t=0;t<De.length;t++)if(r=e,(n=De[t]).msg===r.msg&&n.stack===r.stack&&n.file===r.file&&n.line===r.line&&n.col===r.col)return t;var n,r;return-1}function Ve(e){return e.message||null!=e.lineno}function Ke(e,t,n){var r,o,a,i;return(i=t)&&(i instanceof Error||"object"==typeof i&&"string"==typeof i.message)?(r=t.name||"ErrorLikeObject",o=t.message||"",a=t.stack||void 0):function(e,t){return null==e&&"Script error."===(null==t?void 0:t.message)}(t,n)?(r="CrossOriginError",o=e+" - message: "+((null==n?void 0:n.message)||"<UNKNOWN>")):null===t&&(null==n?void 0:n.message)&&"Uncaught null"!==n.message?(r="Error",o=e+" - message: "+n.message):(r=null==t?""+t:typeof t,o=e+" - value: "+function(e){var t;try{t=e.toString()}catch(e){}return"string"!=typeof t||""===t?t=null===e?"<NULL>":void 0===e?"<UNDEFINED>":""===t?"<EMPTY>":"<UNKNOWN>":t.length>2e3&&(t=t.substring(0,2e3)+"<<< ……"),t}(t)),{error_type:oe.SCRIPT,error_cons_type:r,msg:o,stack:a}}var We=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="error",t.onError=function(e){if(Ve(e)){var r=n(n({},Ke("Global Uncaught Exception",e.error,e)),{file:e.filename,line:e.lineno,col:e.colno});je(t.radar,r)}},t.onPromiseError=function(e){var n=Ke("Unhandled Promise Rejection",e.reason);je(t.radar,n)},t}return t(r,e),r.prototype.when=function(e){if(e.custom){var t=(e.entry||{}).key;if(["play_block","play_error"].indexOf(t)>-1)return!0}return!1},r.prototype.onPerfReport=function(e){if(e.custom){var t=e.entry||{},n=t.key,r=t.value;Ue(this.radar,{error_type:oe.VIDEO,error_cons_type:n,msg:r})}},r.prototype.created=function(){u(window,"error",this.onError,!0),u(window,"unhandledrejection",this.onPromiseError)},r.prototype.destroy=function(){l(window,"error",this.onError,!0),l(window,"unhandledrejection",this.onPromiseError)},r}(ce),Be=["play_block","play_error"],Fe=["c_dimension1","c_dimension2","c_dimension3"],qe=["main_data_receive_end"];return function(e){function n(t,n){var r,o=e.call(this,t,n)||this;return o.radarIgnoreList=["https://web-trace.ksapisrv.com/ktrace/collect"],o.radarFmp=0,o.customReported=[],o.customKeyList=[],o.timelineLastTime=null,o.action={start:function(e){te(e),o.event({name:e.name,extra_info:e.extra_info||"",event_type:"radar_action_start"})},end:function(e){te(e),o.event({name:e.name,extra_info:e.extra_info||"",result_type:e.result_type||"",event_type:"radar_action_end"})}},o.validOption()?((null===(r=o.options)||void 0===r?void 0:r.customDimensions)&&o.setDimensions(o.options.customDimensions),o.options&&o.options.unuseResourcePlugin||(o.use(ve,o),o.use(ye,o)),o.options&&o.options.unuseAPIPlugin||o.use(Pe,o),o.options&&o.options.unuseErrorPlugin||(o.use(Ae,o),o.use(We,o)),o.use(ue,o),o.use(ge,o),o):o}return t(n,e),n.samplingControl=function(e){if(!e)return!1;var t=Math.random();return"number"==typeof e?t<e:t<e.sampling},n.prototype.collect=function(e,t){if(0!==e.indexOf("c_")&&qe.indexOf(e)<0)c("[error 305]","[Radar] 传入的自定义指标 "+e+" 必须为 c_ 开头");else if(qe.indexOf(e)>-1)this.handleCollectKey(e);else{s("[radar]:Radar+之后将不再支持collect方法，请用event方法替代。");var n={key:f.CUSTOM,value:{metric_value:t},dimension:{metric_name:e}};this.logCollect(n),this.logCollectNext({key:f.EVENT,value:{duration:t},dimension:{name:e}})}},n.prototype.handleCollectKey=function(e){switch(e){case"main_data_receive_end":var t=Date.now();try{performance.timing&&(performance.timing[e]=t)}catch(e){}z(e,t)}},n.prototype.reportTimePoint=function(e,t){if(this.customReported.indexOf(e)>-1)return null;-1===Be.indexOf(e)&&this.customReported.push(e);var n=t;if("string"!=typeof t){var r=function(e){var t="undefined"!=typeof window?window.performance:null;if(!t)return{value:null};if(null!=e)return{value:e-t.timing.navigationStart,detail:{start:"navigationStart",startPoint:t.timing.navigationStart,end:"customTime",endPoint:e}};if("function"==typeof t.now)return{value:t.now(),detail:{start:"navigationStart",startPoint:t.timing.navigationStart,end:"perfNowAPI",endPoint:t.now()}};var n=Date.now();return{value:n-t.timing.navigationStart,detail:{start:"navigationStart",startPoint:t.timing.navigationStart,end:"dateNow",endPoint:n}}}(t);if(null==r.value)return;n=this.throttle(r.value,r.detail,"fmp",r.detail)}return null!=n?(this.reportPerformance({custom:!0,entry:{key:e,value:n},renderTime:t}),n):void 0},n.prototype.fmp=function(e){if(e&&"number"!=typeof e)c("[radar]: fmp方法入参请传时间戳，或选择不传！");else{this.radarFmp=e||Date.now();var t=this.reportTimePoint("fmp",this.radarFmp);if(t){this.hasFmp=!0;try{performance.timing&&(performance.timing.fmp=t,performance.timing.radarFmp=this.radarFmp)}catch(e){}z("fmp",t);var n={key:f.CUSTOM,value:{fmp:t,fmp_time:this.radarFmp,merge:!0}};this.logCollect(n),this.logCollectNext({key:f.EVENT,value:{duration:t},dimension:{name:"fmp"}})}}},n.prototype.event=function(e,t){if(e&&e.name)if("string"==typeof e.name){e.name.length>127&&(c("[radar]:事件名称长度不能超过127字符，超过会截取后上报，请限制"),e.name=e.name.slice(0,127));var n=J();e.extra_info&&e.extra_info instanceof Object&&(e.extra_info=JSON.stringify(e.extra_info)),void 0===e.yoda_version&&(e.yoda_version=n.Yoda||""),void 0===e.webview_type&&(e.webview_type=Y());var r={key:f.EVENT,value:t,dimension:e};this.logCollect(r),this.logCollectNext(r)}else c("[radar]:name字段需要为String类型");else c("[radar]:事件名称为必填字段，用于监控展示、报警配置，请填写")},n.prototype.customStage=function(e,t){if(!(this.customKeyList.length>2)){if(t=t||{sendTimeline:!0},this.customKeyList.indexOf(e)>-1)return null;this.customKeyList.push(e);var n=Date.now();"production"!==this.weblog.logConfig.env&&(this.timelineLastTime?this.timelineLastTime:this.timelineLastTime=n),this.customPerfList[e]={options:t,time:n},this.reportPerformance({custom:!0,entry:{key:"customPerf",value:e},renderTime:n})}},n.prototype.headlessTestReport=function(){-1===window.navigator.userAgent.indexOf("headless")||this.asyncReportTiming()},n.prototype.playClicked=function(e){this.reportTimePoint("play_clicked",e)},n.prototype.playIDR=function(e){this.reportTimePoint("play_idr",e)},n.prototype.playBlock=function(e){this.reportTimePoint("play_block",e)},n.prototype.playError=function(e){this.reportTimePoint("play_error",e)},n.prototype.setDimensions=function(e){var t=this,n=Object.keys(e);n.some((function(e){return-1===Fe.indexOf(e)}))&&c("[error 306]","[Radar] 传入的自定义维度只能为 "+Fe.join("、")+"，目前传入的是："+n.join("、")),n.forEach((function(n){var r=n;null==e[r]?delete t.customDimension[r]:t.customDimension[r]=e[r]}))},n.prototype.validOption=function(){var e=this;if(!this.options)return!1;var t=this.options,n=t.sampling;return"string"!=typeof t.projectId?(c("[error 303]","[Radar] 必须配置 projectId 属性，类型为 string!"),!1):n>1||n<0?(c("[error 304]","[Radar] 采样率 sampling 必须为 0~1 之间的数字"),!1):(["apiSampling","errorSampling","resourceSampling","customSampling","eventSampling"].forEach((function(t){var n=e.options[t];"number"==typeof n&&0===n&&c("[error 304]","[Radar] 采样率 "+t+" 不能被设置为 0，将改用默认值")})),!0)},n.prototype.captureException=function(e){xe(this,Re("capture exception",e)),je(this,Ke("Captured Exception",e))},n.__test__={MORE_REPORTED:Be,CUSTOM_DIM_KEY:Fe,CUSTOM_COLLECT_KEY:qe},n.key="radar",n}(se)}()},function(e,t,n){"use strict";var r,o=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.KwaiPixel=void 0;var a=n(0),i=n(5),s=n(4),c=n(25),u=n(2),l=n(3),d=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.currentHref="",r}return o(t,e),t.prototype.getInstance=function(){var e=this;return this.instancePromise||(this.instancePromise=i.xhrService.get(a.API.GET_PIXEL+"?pixelId="+this.pixelId),this.instancePromise.then((function(t){(0,u.logFMP)();var n=t.status,r=t.message,o=void 0===r?"":r,a=t.data;if(200!==n)e.instancePromise=null;else if(200===n&&a){var i=JSON.stringify({data:a,message:o});(0,u.logUp)({name:l.LoggerTypesName.successConfig,extra_info:i});var c=JSON.parse(a);(0,s.getWorkspace)().instance(e.pixelId).setPixelInfo(c)}})).catch((function(t){var n=JSON.stringify({pixelId:e.pixelId,accessMode:e.accessMode,currentHref:e.currentHref,error:t});(0,u.logErr)({name:l.LoggerTypesName.errConfig,extra_info:n}),e.instancePromise=null}))),this.instancePromise},t.prototype.page=function(e){window.location.href!==this.currentHref&&(this.track(a.PAGE_VIEW_EVENT_NAME,e),this.currentHref=window.location.href)},t}(c.Pixel);t.KwaiPixel=d},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(e){a=[6,e],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Pixel=void 0;var a=n(0),i=n(1),s=function(){function e(e,t){this.pixelId=e,this.context=t,this.loaded=!1,this.accessMode=1,this.instancePromise=this.getInstance()}return e.prototype.track=function(e,t,n){var r=this;this.getInstance().then((function(){n&&n!==r.accessMode||!n&&2===r.accessMode||r.context.track(r.pixelId,e,t,a.REPORT_TYPE.TRACK,n)}))},e.prototype.setPixelInfo=function(e){var t,n,r;if(2===e.accessMode&&(null===(r=null===(n=null===(t=this.context)||void 0===t?void 0:t.data)||void 0===n?void 0:n.adInfo)||void 0===r?void 0:r.pixelId)==e.pixelId&&(this.accessMode=e.accessMode),2===e.accessMode&&e.eventData&&Array.isArray(e.eventData)&&e.eventData.length>0)for(var o=0;o<e.eventData.length;o++)e.eventData[o].traceContent=JSON.parse(e.eventData[o].traceContent),this.initPixel(e.eventData[o])},e.prototype.initPixel=function(e){var t=e.eventType,n=e.traceMethod,r=e.traceContent;if(1===n)for(var o=0;o<r[0].destination.length;o++)window.location.href.split("?")[0].indexOf(r[0].destination[o])>-1&&this.track(a.EVENT_NAME_FORMAT[t],e,2);else this.bindEvents(e.traceContent[0].destination,e.traceContent[0].traceUrl,t,e)},e.prototype.bindEvents=function(e,t,n,s){return r(this,void 0,void 0,(function(){var r;return o(this,(function(o){return r=this,e.forEach((function(e){var o=document.querySelector(e);window.location.href.split("?")[0];(0,i.getUrlIn)(window.location.href,t)&&o&&o.addEventListener("click",(function(){r.track(a.EVENT_NAME_FORMAT[n],s,2)}),!0)})),[2]}))}))},e}();t.Pixel=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;var r=function(e){var t=this;this.loadPixel=function(e){if(!t.context.getPixel(e)){var n=t.createPixel(e);t.context.addPixel(n)}},this.setPageInfo=function(e,n){t.context.setPageInfo(e,n)},this.usePlugin=function(e){try{var n=new e(t.context);t.context.usePlugin(n)}catch(e){}},this.useDynamicPlugin=function(e){try{var n=e(t.context);t.context.usePlugin(n)}catch(e){}},this.instance=function(e){var n=t.context.getPixel(e);if(n)return n},this.instances=function(){return t.context.getAllPixels()},this.page=function(e){t.instances().forEach((function(t){return t.page(e)}))},this.track=function(e,n){t.instances().forEach((function(t){return t.track(e,n)}))},this.initialize=!0,this.context=e};t.Manager=r}])}));